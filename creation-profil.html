<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Création de Profil</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
body {
  margin:0; padding:0; font-family:'Orbitron',sans-serif;
  background:url('ville.jpg') no-repeat center center/cover;
  display:flex; justify-content:center; align-items:center; height:100vh;
}
.form-container {
  background: rgba(255,0,255,0.1);
  border:2px solid #ff66cc;
  border-radius:20px;
  padding:30px;
  width:90%;
  max-width:500px;
  color:white;
  box-shadow:0 0 20px #ff66cc;
}
.form-container h1 {
  text-align:center;
  margin-bottom:20px;
  text-shadow: 0 0 5px black, 0 0 10px #ff66cc;
}
input, textarea {
  width:100%; margin-bottom:15px; padding:10px; border-radius:8px;
  border:none; background:rgba(255,255,255,0.1); color:white; font-size:16px;
  outline:none;
}
textarea { resize:none; }
label { display:block; margin-bottom:5px; }
.room-option { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
.room-option input { width:auto; }
img.preview { width:70px; height:70px; object-fit:cover; border-radius:10px; border:2px solid #ff66cc; margin-right:5px; }
button { width:100%; padding:12px; border:none; border-radius:10px; background:#ff66cc; color:white; font-size:18px; cursor:pointer; transition:0.3s; }
button:hover { box-shadow:0 0 15px #ff66cc,0 0 25px #d600d6; }
.room-logos img { width:30px; height:30px; margin-right:5px; }
</style>
</head>
<body>

<div class="form-container">
<h1>Création de Profil</h1>

<form id="profileForm">
  <label>Photos (max 5) :</label>
  <input type="file" id="photos" multiple accept="image/*">

  <div id="previewContainer" style="display:flex; margin-bottom:15px;"></div>

  <label>Description :</label>
  <textarea id="description" rows="3" placeholder="Parlez de vous..."></textarea>

  <label>Âge :</label>
  <input type="number" id="age" min="12" max="120">

  <label>Lieu :</label>
  <input type="text" id="location" placeholder="Votre ville">

  <label>Salles souhaitées :</label>
  <div class="room-option">
    <input type="checkbox" value="serieux" class="roomCheckbox"> Sérieux
    <img src="icons/serieux.png" alt="Sérieux">
  </div>
  <div class="room-option">
    <input type="checkbox" value="amitie" class="roomCheckbox"> Amitié
    <img src="icons/amitie.png" alt="Amitié">
  </div>
  <div class="room-option">
    <input type="checkbox" value="fun" class="roomCheckbox"> Fun
    <img src="icons/fun.png" alt="Fun">
  </div>

  <button type="submit">Enregistrer Profil</button>
</form>
</div>

<script type="module">
import { getAuth } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
import { app } from "./firebase.js";

const auth = getAuth(app);
const db = getDatabase(app);

const form = document.getElementById('profileForm');
const photosInput = document.getElementById('photos');
const previewContainer = document.getElementById('previewContainer');
let selectedFiles = [];

// Prévisualisation photos
photosInput.addEventListener('change', (e)=>{
  selectedFiles = Array.from(e.target.files).slice(0,5);
  previewContainer.innerHTML = '';
  selectedFiles.forEach(f=>{
    const img = document.createElement('img');
    img.src = URL.createObjectURL(f);
    img.className = 'preview';
    previewContainer.appendChild(img);
  });
});

// Formulaire
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const user = auth.currentUser;
  if(!user){ alert("Vous devez être connecté"); return; }

  const selectedRooms = Array.from(document.querySelectorAll('.roomCheckbox'))
                            .filter(cb=>cb.checked).map(cb=>cb.value);

  const profileData = {
    photos: selectedFiles.map(f=>f.name),
    description: document.getElementById('description').value,
    age: document.getElementById('age').value,
    location: document.getElementById('location').value,
    rooms: selectedRooms
  };

  try {
    await set(ref(db, 'users/' + user.uid + '/profile'), profileData);
    alert("Profil enregistré !");
    window.location.href = 'page2.html';
  } catch(err){
    console.error("Erreur DB :", err);
    alert("Erreur lors de l'enregistrement du profil");
  }
});
</script>
</body>
</html>
