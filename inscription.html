<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inscription</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body {
    height: 100%; width: 100%;
    font-family: 'Orbitron', sans-serif;
    background: url("ville.jpg") no-repeat center center/cover;
    color: #fff;
    overflow-y: auto;
  }
  .container {
    background: rgba(0,0,0,0.4);
    padding: 20px;
    border-radius: 15px;
    width: 95%; max-width: 500px;
    margin: 40px auto;
    box-shadow: 0 0 20px #ff66cc;
    text-align: center;
  }
  h1 { color: #ff66cc; text-shadow: 0 0 10px #ff66cc; margin-bottom: 15px; }
  input, textarea {
    width: 100%; margin: 10px 0; padding: 10px;
    border-radius: 8px; border: 2px solid #ff66cc;
    background: rgba(0,0,0,0.5); color: #fff;
  }
  .salles { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
  .salle-btn {
    padding: 8px 15px; border: 2px solid #ff66cc; border-radius: 10px;
    background: rgba(0,0,0,0.4); color: #fff; cursor: pointer;
  }
  .salle-btn.active {
    box-shadow: 0 0 15px #ff66cc; background: rgba(255,102,204,0.8);
  }
  .photos-preview { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px; }
  .photos-preview img {
    width: 70px; height: 70px; object-fit: cover; border-radius: 8px;
    border: 2px solid #ff66cc; cursor: zoom-in; transition: transform 0.2s;
  }
  .photos-preview img:hover { transform: scale(1.2); }
  button {
    margin: 10px; padding: 10px 20px; border-radius: 8px;
    border: 2px solid #ff66cc; background: rgba(0,0,0,0.4);
    color: #fff; cursor: pointer; font-size: 1em;
    text-transform: uppercase; box-shadow: 0 0 10px #ff66cc;
  }
  button:hover { box-shadow: 0 0 20px #ff66cc; }
</style>
</head>
<body>
<div class="container">
  <h1>Inscription</h1>

  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <input type="text" id="pseudo" placeholder="Pseudo">
  <input type="number" id="age" placeholder="Âge">
  <input type="text" id="location" placeholder="Lieu">
  <textarea id="description" placeholder="Description..."></textarea>

  <div class="salles">
    <div class="salle-btn" data-value="serieux">Sérieux</div>
    <div class="salle-btn" data-value="amicale">Amicale</div>
    <div class="salle-btn" data-value="fun">Fun</div>
  </div>

  <label for="photos">Ajoute jusqu’à 5 photos :</label>
  <input type="file" id="photos" accept="image/*" multiple>
  <div class="photos-preview" id="photosPreview"></div>

  <button id="signupBtn">S’inscrire</button>
  <button id="loginBtn">Se connecter</button>
</div>

<script type="module">
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } 
  from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getDatabase, ref, set } 
  from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } 
  from "https://www.gstatic.com/firebasejs/12.2.1/firebase-storage.js";
import { app } from "./firebase.js";

const auth = getAuth(app);
const db = getDatabase(app);
const storage = getStorage(app);

const email = document.getElementById("email");
const password = document.getElementById("password");
const pseudo = document.getElementById("pseudo");
const age = document.getElementById("age");
const locationInput = document.getElementById("location");
const description = document.getElementById("description");
const photosInput = document.getElementById("photos");
const preview = document.getElementById("photosPreview");
const signupBtn = document.getElementById("signupBtn");
const loginBtn = document.getElementById("loginBtn");

let uploadedPhotos = [];
let selectedRooms = [];

// Prévisualisation
photosInput.addEventListener("change", e => {
  preview.innerHTML = "";
  uploadedPhotos = [];
  [...e.target.files].slice(0,5).forEach(file => {
    const reader = new FileReader();
    reader.onload = ev => {
      const img = document.createElement("img");
      img.src = ev.target.result;
      img.addEventListener("click", () => window.open(ev.target.result, "_blank"));
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
    uploadedPhotos.push(file);
  });
});

// Salles
document.querySelectorAll(".salle-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const val = btn.dataset.value;
    btn.classList.toggle("active");
    if(selectedRooms.includes(val)) selectedRooms = selectedRooms.filter(r=>r!==val);
    else selectedRooms.push(val);
  });
});

// INSCRIPTION
signupBtn.addEventListener("click", async ()=>{
  try {
    const userCred = await createUserWithEmailAndPassword(auth, email.value, password.value);
    const user = userCred.user;

    const photoURLs = [];
    for (const file of uploadedPhotos) {
      const storageRef = sRef(storage, `users/${user.uid}/${file.name}`);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);
      photoURLs.push(url);
    }

    await set(ref(db, "users/" + user.uid), {
      email: email.value,
      pseudo: pseudo.value,
      age: age.value,
      location: locationInput.value,
      description: description.value,
      rooms: selectedRooms,
      photos: photoURLs,
      online: false,
      gender: "girl"
    });

    window.location.href = "page2.html";

  } catch (e) {
    alert("Erreur: " + e.message);
  }
});

// CONNEXION
loginBtn.addEventListener("click", async ()=>{
  try {
    await signInWithEmailAndPassword(auth, email.value, password.value);
    window.location.href = "page2.html";
  } catch (e) {
    alert("Erreur: " + e.message);
  }
});
</script>
</body>
</html>
