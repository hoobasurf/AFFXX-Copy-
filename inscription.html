<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inscription</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
<style>
  body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: url("ville.jpg") no-repeat center center/cover;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow-y: auto;
  }
  .container {
    background: rgba(0,0,0,0.4);
    padding: 20px;
    border-radius: 15px;
    width: 95%;
    max-width: 500px;
    box-shadow: 0 0 20px #ff66cc;
    text-align: center;
  }
  h1 {
    color: #ff66cc;
    text-shadow: 0 0 10px #ff66cc;
  }
  input, select, textarea {
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border-radius: 8px;
    border: 2px solid #ff66cc;
    background: rgba(0,0,0,0.5);
    color: #fff;
  }
  .neon-btns button {
    margin: 5px;
    padding: 10px 15px;
    border-radius: 8px;
    border: 2px solid #ff66cc;
    background: rgba(0,0,0,0.4);
    color: #fff;
    cursor: pointer;
    text-transform: uppercase;
    box-shadow: 0 0 10px #ff66cc, 0 0 20px #ff66cc inset;
    transition: 0.3s;
  }
  .neon-btns button.active {
    box-shadow: 0 0 20px #ff66cc, 0 0 30px #ff66cc inset;
    background: #ff66cc;
    color: #000;
  }
  .photos-preview {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
  }
  .photos-preview img {
    width: 70px;
    height: 70px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid #ff66cc;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .photos-preview img:hover { transform: scale(1.2); }
  .lightbox {
    display: none;
    position: fixed;
    z-index: 1000;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
  }
  .lightbox img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 10px;
    box-shadow: 0 0 25px #ff66cc;
  }

  /* Vortex overlay semi-transparent */
  #vortexOverlay {
    position: fixed;
    top:0; left:0;
    width:100vw;
    height:100vh;
    display: flex;
    justify-content:center;
    align-items:center;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    background: rgba(0,0,0,0.3);
  }
  #vortexOverlay video {
    width:100vw;
    height:100vh;
    object-fit: cover;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Inscription</h1>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <input type="text" id="pseudo" placeholder="Pseudo">
  <input type="number" id="age" placeholder="Âge">
  <input type="text" id="location" placeholder="Lieu">
  <textarea id="description" placeholder="Description..."></textarea>

  <div class="neon-btns">
    <button data-room="serieux">Sérieux</button>
    <button data-room="amicale">Amicale</button>
    <button data-room="fun">Fun</button>
  </div>

  <label for="photos">Ajoute jusqu’à 5 photos :</label>
  <input type="file" id="photos" accept="image/*" multiple>
  <div class="photos-preview" id="photosPreview"></div>

  <button id="signupBtn">S’inscrire</button>
  <button id="loginBtn">Se connecter</button>
</div>

<div class="lightbox" id="lightbox">
  <img id="lightboxImg" src="">
</div>

<div id="vortexOverlay">
  <video autoplay muted playsinline id="vortexVideo">
    <source src="vortex.mov" type="video/quicktime"/>
  </video>
</div>

<script type="module">
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
import { app } from "./firebase.js";

const auth = getAuth(app);
const db = getDatabase(app);

const email = document.getElementById("email");
const password = document.getElementById("password");
const pseudo = document.getElementById("pseudo");
const age = document.getElementById("age");
const locationInput = document.getElementById("location");
const description = document.getElementById("description");
const photosInput = document.getElementById("photos");
const preview = document.getElementById("photosPreview");

let uploadedPhotos = [];
let selectedRooms = [];

photosInput.addEventListener("change", e => {
  preview.innerHTML = "";
  uploadedPhotos = [];
  [...e.target.files].slice(0,5).forEach(file => {
    const reader = new FileReader();
    reader.onload = ev => {
      const img = document.createElement("img");
      img.src = ev.target.result;
      img.addEventListener("click", () => {
        lightboxImg.src = ev.target.result;
        lightbox.style.display = "flex";
      });
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
    uploadedPhotos.push(file);
  });
});

const neonButtons = document.querySelectorAll(".neon-btns button");
neonButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    btn.classList.toggle("active");
    const room = btn.dataset.room;
    if(selectedRooms.includes(room)) {
      selectedRooms = selectedRooms.filter(r => r!==room);
    } else {
      selectedRooms.push(room);
    }
  });
});

const vortexOverlay = document.getElementById("vortexOverlay");
const lightboxImg = document.getElementById("lightboxImg");
const lightbox = document.getElementById("lightbox");

lightbox.addEventListener("click", () => {
  lightbox.style.display = "none";
  lightboxImg.src = "";
});

function playVortexAndRedirect(callback) {
  vortexOverlay.style.opacity = "1";
  vortexOverlay.style.pointerEvents = "all";
  const video = document.getElementById("vortexVideo");
  video.currentTime = 0;
  video.play();
  video.onended = () => {
    callback();
  };
}

signupBtn.addEventListener("click", async () => {
  playVortexAndRedirect(async () => {
    try {
      const userCred = await createUserWithEmailAndPassword(auth, email.value, password.value);
      const user = userCred.user;
      const rooms = selectedRooms;
      await set(ref(db, "users/" + user.uid), {
        email: email.value,
        pseudo: pseudo.value,
        age: age.value,
        location: locationInput.value,
        description: description.value,
        rooms: rooms
      });
      window.location.href = "page2.html";
    } catch(e){ alert("Erreur : "+e.message); }
  });
});

loginBtn.addEventListener("click", () => {
  playVortexAndRedirect(async () => {
    try {
      await signInWithEmailAndPassword(auth, email.value, password.value);
      window.location.href = "page2.html";
    } catch(e){ alert("Erreur : "+e.message); }
  });
});
</script>
</body>
</html>
