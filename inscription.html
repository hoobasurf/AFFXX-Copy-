<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Inscription</title>
<link rel="stylesheet" href="style.css" />
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAbI0fvcv9lIzpPViVBx2BlO8c6L3w-rbc",
  authDomain: "affxx-copy.firebaseapp.com",
  databaseURL: "https://affxx-copy-default-rtdb.firebaseio.com",
  projectId: "affxx-copy",
  storageBucket: "affxx-copy.appspot.com",
  messagingSenderId: "763273288933",
  appId: "1:763273288933:web:d0083f5f6ab7284661c80c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// --- INSCRIPTION ---
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("signupForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const pseudo = document.getElementById("pseudo").value.trim();
    const age = document.getElementById("age").value.trim();
    const location = document.getElementById("location").value.trim();
    const description = document.getElementById("description").value.trim();

    if (!email || !password || !pseudo) {
      alert("Merci de remplir les champs obligatoires (email, mot de passe, pseudo)");
      return;
    }

    try {
      let userCredential;
      try {
        // Tentative de création de compte
        userCredential = await createUserWithEmailAndPassword(auth, email, password);
      } catch (err) {
        // Si déjà existant → on connecte
        if (err.code === "auth/email-already-in-use") {
          userCredential = await signInWithEmailAndPassword(auth, email, password);
        } else {
          throw err;
        }
      }

      const user = userCredential.user;
      const userData = {
        pseudo,
        age,
        location,
        description,
        online: true,
        photos: []
      };

      await set(ref(db, "users/" + user.uid), userData);
      window.location.href = "page2.html";
    } catch (error) {
      console.error("Erreur Firebase :", error);
      alert("Erreur : " + error.message);
    }
  });
});

// --- ZOOM PHOTO (inchangé) ---
function openLightbox(src) {
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightboxImg");
  lightboxImg.src = src;
  lightbox.style.display = "flex";
}
function closeLightbox() {
  document.getElementById("lightbox").style.display = "none";
}
window.openLightbox = openLightbox;
window.closeLightbox = closeLightbox;
</script>
</head>
<body>

<div class="container">
  <h1>Inscription</h1>
  <form id="signupForm">
    <label>Email :</label>
    <input type="email" id="email" required><br>

    <label>Mot de passe :</label>
    <input type="password" id="password" required><br>

    <label>Pseudo :</label>
    <input type="text" id="pseudo" required><br>

    <label>Âge :</label>
    <input type="number" id="age"><br>

    <label>Lieu :</label>
    <input type="text" id="location"><br>

    <label>Description :</label>
    <textarea id="description"></textarea><br>

    <button type="submit" id="signupBtn">S’inscrire</button>
  </form>
</div>

<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <img id="lightboxImg" src="">
</div>

</body>
</html>
