<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Inscription</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    height:100%; width:100%;
    font-family: 'Orbitron', sans-serif;
    background: url('ville.jpg') no-repeat center center/cover;
    display: flex; justify-content: center; align-items: center; color: #fff;
  }
  .container {
    background: rgba(0,0,0,0.4);
    padding: 25px;
    border-radius: 15px;
    width: 95%; max-width: 500px;
    text-align: center;
    box-shadow: 0 0 20px #ff66cc;
  }
  h1 { color:#ff66cc; text-shadow:0 0 10px #ff66cc; margin-bottom:15px; }
  input, textarea {
    width:100%; margin:10px 0; padding:10px; border-radius:8px;
    border:2px solid #ff66cc; background: rgba(0,0,0,0.5); color:#fff;
  }
  button {
    margin:10px; padding:10px 20px; border-radius:8px;
    border:2px solid #ff66cc; background: rgba(0,0,0,0.4); color:#fff;
    cursor:pointer; font-size:1em; text-transform:uppercase;
    box-shadow: 0 0 10px #ff66cc,0 0 20px #ff66cc inset; transition:0.3s;
  }
  button:hover { box-shadow:0 0 20px #ff66cc,0 0 30px #ff66cc inset; }

  .photos-preview {
    display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:10px;
  }
  .photos-preview img {
    width:70px; height:70px; object-fit:cover; border-radius:8px;
    border:2px solid #ff66cc; cursor:pointer; transition: transform 0.2s;
  }
  .photos-preview img:hover { transform: scale(1.2); }

  /* Lightbox */
  .lightbox {
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000;
  }
  .lightbox img {
    max-width:90%; max-height:90%; border-radius:10px;
    box-shadow:0 0 25px #ff66cc;
  }

  /* Boutons salles néon */
  #roomButtonsContainer { margin:15px 0; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
  .room-btn {
    padding:10px 20px; border-radius:8px; border:2px solid #ff66cc; background:rgba(0,0,0,0.4);
    color:#fff; cursor:pointer; text-transform:uppercase; font-size:0.9em;
    box-shadow:0 0 10px #ff66cc,0 0 20px #ff66cc inset; transition:0.3s;
  }
  .room-btn:hover { box-shadow:0 0 20px #ff66cc,0 0 30px #ff66cc inset; }
  .room-btn.active { background:#ff66cc; color:#fff; box-shadow:0 0 20px #ff66cc; }
</style>
</head>
<body>
  <div class="container" id="container">
    <h1>Inscription</h1>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Mot de passe">
    <input type="text" id="pseudo" placeholder="Pseudo">
    <input type="number" id="age" placeholder="Âge">
    <input type="text" id="location" placeholder="Lieu">
    <textarea id="description" placeholder="Description..."></textarea>

    <div id="roomButtonsContainer">
      <div class="room-btn" data-room="serieux">Sérieux</div>
      <div class="room-btn" data-room="amicale">Amicale</div>
      <div class="room-btn" data-room="fun">Fun</div>
    </div>

    <label for="photos">Ajoute jusqu’à 5 photos :</label>
    <input type="file" id="photos" accept="image/*" multiple>
    <div class="photos-preview" id="photosPreview"></div>

    <button id="signupBtn">S’inscrire</button>
    <button id="loginBtn">Se connecter</button>
  </div>

  <div class="lightbox" id="lightbox">
    <img id="lightboxImg" src="">
  </div>

  <script type="module">
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
  import { app } from "./firebase.js";

  const auth = getAuth(app);
  const db = getDatabase(app);

  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const pseudo = document.getElementById("pseudo");
  const age = document.getElementById("age");
  const locationInput = document.getElementById("location");
  const description = document.getElementById("description");
  const photosInput = document.getElementById("photos");
  const photosPreview = document.getElementById("photosPreview");
  const container = document.getElementById("container");
  const signupBtn = document.getElementById("signupBtn");

  let uploadedPhotos = [];
  let selectedRooms = [];

  photosInput.addEventListener("change", e => {
    photosPreview.innerHTML = "";
    uploadedPhotos = [];
    [...e.target.files].slice(0,5).forEach(file=>{
      const reader = new FileReader();
      reader.onload = ev=>{
        const img = document.createElement("img");
        img.src = ev.target.result;
        img.addEventListener("click", ()=>{
          document.getElementById("lightboxImg").src = ev.target.result;
          document.getElementById("lightbox").style.display="flex";
        });
        photosPreview.appendChild(img);
      };
      reader.readAsDataURL(file);
      uploadedPhotos.push(file);
    });
  });

  const roomButtons = document.querySelectorAll("#roomButtonsContainer .room-btn");
  const maxSelection = 3;
  roomButtons.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const room = btn.dataset.room;
      if(selectedRooms.includes(room)){
        selectedRooms = selectedRooms.filter(r=>r!==room);
        btn.classList.remove("active");
      } else {
        if(selectedRooms.length<maxSelection){
          selectedRooms.push(room);
          btn.classList.add("active");
        }
      }
    });
  });

  signupBtn.addEventListener("click", async ()=>{
    if(selectedRooms.length===0){ alert("Choisis au moins une salle"); return; }

    container.style.transition="transform 0.6s ease-in-out, opacity 0.6s ease-in-out";
    container.style.transform="scale(2)";
    container.style.opacity="0";

    container.addEventListener("transitionend", async function handler(){
      container.removeEventListener("transitionend", handler);

      try{
        const userCred = await createUserWithEmailAndPassword(auth,email.value,password.value);
        const user = userCred.user;

        const photosData = uploadedPhotos.map(file=>URL.createObjectURL(file));
        await set(ref(db,"users/"+user.uid),{
          email: email.value,
          pseudo: pseudo.value,
          age: age.value,
          location: locationInput.value,
          description: description.value,
          rooms: selectedRooms,
          photos: photosData
        });
        window.location.href="page2.html";
      } catch(e){
        alert("Erreur : "+e.message);
        container.style.transform="scale(1)";
        container.style.opacity="1";
      }
    });
  });

  document.getElementById("lightbox").addEventListener("click", ()=>{
    document.getElementById("lightbox").style.display="none";
  });
  </script>
</body>
</html>
