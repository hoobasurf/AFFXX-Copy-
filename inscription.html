<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Inscription</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
<style>
body {
  margin: 0;
  font-family: 'Orbitron', sans-serif;
  background: url("ville.jpg") no-repeat center center/cover;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  overflow: hidden;
}
.container {
  background: rgba(0,0,0,0.4);
  padding: 20px;
  border-radius: 15px;
  width: 95%;
  max-width: 500px;
  box-shadow: 0 0 20px #ff66cc;
  text-align: center;
  z-index: 1;
  position: relative;
}
h1 { color:#ff66cc; text-shadow:0 0 10px #ff66cc; }
input, textarea { width: 100%; margin: 10px 0; padding: 10px; border-radius: 8px; border: 2px solid #ff66cc; background: rgba(0,0,0,0.5); color: #fff; }
.photos-preview { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 10px; }
.photos-preview img { width:70px; height:70px; object-fit:cover; border-radius:8px; border:2px solid #ff66cc; cursor:pointer; transition: transform 0.2s; }
.photos-preview img:hover { transform: scale(1.2); }
/* Lightbox */
.lightbox { display:none; position:fixed; z-index:10000; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); justify-content:center; align-items:center; }
.lightbox img { max-width:90%; max-height:90%; border-radius:10px; box-shadow:0 0 25px #ff66cc; }
/* Boutons salles néon */
.room-btn { padding:10px 20px; margin:5px; border:2px solid #ff66cc; background:rgba(0,0,0,0.4); color:#fff; border-radius:8px; cursor:pointer; font-size:0.9em; box-shadow:0 0 10px #ff66cc,0 0 20px #ff66cc inset; transition:0.3s; }
.room-btn.selected { box-shadow:0 0 20px #ff66cc,0 0 30px #ff66cc inset; background: rgba(255,102,204,0.8);}
.room-btn:hover { box-shadow:0 0 20px #ff66cc,0 0 30px #ff66cc inset; }
/* Zoom animation */
.zoom-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:9999; transform: scale(0); transition: transform 0.6s ease-in; }
.zoom-overlay.active { transform: scale(1); }
</style>
</head>
<body>

<div class="container">
  <h1>Inscription</h1>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Mot de passe">
  <input type="text" id="pseudo" placeholder="Pseudo">
  <input type="number" id="age" placeholder="Âge">
  <input type="text" id="location" placeholder="Lieu">
  <textarea id="description" placeholder="Description..."></textarea>

  <div id="roomButtonsContainer">
    <label>Choisis tes salles :</label><br>
    <div id="roomsBtns"></div>
  </div>

  <label for="photos">Ajoute jusqu’à 5 photos :</label>
  <input type="file" id="photos" accept="image/*" multiple>
  <div class="photos-preview" id="photosPreview"></div>

  <button id="signupBtn">S’inscrire</button>
  <button id="loginBtn">Se connecter</button>
</div>

<div class="lightbox" id="lightbox">
  <img id="lightboxImg" src="">
</div>

<div class="zoom-overlay" id="zoomOverlay"></div>

<script type="module">
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
import { app } from "./firebase.js";

const auth = getAuth(app);
const db = getDatabase(app);

const email = document.getElementById("email");
const password = document.getElementById("password");
const pseudo = document.getElementById("pseudo");
const age = document.getElementById("age");
const locationInput = document.getElementById("location");
const description = document.getElementById("description");
const photosInput = document.getElementById("photos");
const preview = document.getElementById("photosPreview");

const signupBtn = document.getElementById("signupBtn");
const loginBtn = document.getElementById("loginBtn");

const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightboxImg");
const zoomOverlay = document.getElementById("zoomOverlay");

// Gestion des salles néon
const rooms = ["serieux","amicale","fun"];
const roomsBtnsDiv = document.getElementById("roomsBtns");
let selectedRooms = [];

rooms.forEach(r=>{
  const btn = document.createElement("button");
  btn.className = "room-btn";
  btn.textContent = r;
  btn.addEventListener("click", ()=>{
    if(selectedRooms.includes(r)) selectedRooms = selectedRooms.filter(x=>x!==r);
    else selectedRooms.push(r);
    updateRoomsVisual();
  });
  roomsBtnsDiv.appendChild(btn);
});
function updateRoomsVisual(){
  document.querySelectorAll(".room-btn").forEach(btn=>{
    btn.classList.remove("selected");
    if(selectedRooms.includes(btn.textContent)) btn.classList.add("selected");
  });
}

// Gestion des photos
let uploadedPhotos = [];
photosInput.addEventListener("change", e=>{
  preview.innerHTML = "";
  uploadedPhotos = [];
  [...e.target.files].slice(0,5).forEach(file=>{
    const reader = new FileReader();
    reader.onload = ev=>{
      const img = document.createElement("img");
      img.src = ev.target.result;
      img.addEventListener("click", ()=>{
        lightboxImg.src = ev.target.result;
        lightbox.style.display = "flex";
      });
      preview.appendChild(img);
    };
    reader.readAsDataURL(file);
    uploadedPhotos.push(file);
  });
});

// Inscriptions avec zoom
signupBtn.addEventListener("click", async ()=>{
  zoomOverlay.classList.add("active");
  try{
    const userCred = await createUserWithEmailAndPassword(auth,email.value,password.value);
    const user = userCred.user;
    const photoUrls = uploadedPhotos.map(file=>URL.createObjectURL(file));
    await set(ref(db,"users/"+user.uid),{
      email: email.value,
      pseudo: pseudo.value,
      age: age.value,
      location: locationInput.value,
      description: description.value,
      rooms: selectedRooms,
      photos: photoUrls
    });
    // Redirection immédiate après le début du zoom
    setTimeout(()=> window.location.href="page2.html", 50);
  }catch(e){
    zoomOverlay.classList.remove("active");
    alert("Erreur : "+e.message);
  }
});

loginBtn.addEventListener("click", async ()=>{
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
    window.location.href="page2.html";
  }catch(e){
    alert("Erreur : "+e.message);
  }
});

lightbox.addEventListener("click", ()=>{
  lightbox.style.display="none";
  lightboxImg.src="";
});
</script>
</body>
</html>
