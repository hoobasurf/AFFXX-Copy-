<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Inscription</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Inscription</h1>

    <input type="email" id="email" placeholder="Adresse e-mail" autocomplete="off">
    <input type="password" id="password" placeholder="Mot de passe">
    <button id="signupBtn">S‚Äôinscrire</button>

    <p id="message" style="color:#ff66cc;margin-top:10px;"></p>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { 
  getAuth,
  createUserWithEmailAndPassword,
  signOut
} from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { 
  getDatabase,
  ref,
  set
} from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

/* ---------- CONFIG FIREBASE ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyAbI0fvcv9lIzpPViVBx2BlO8c6L3w-rbc",
  authDomain: "affxx-copy.firebaseapp.com",
  databaseURL: "https://affxx-copy-default-rtdb.firebaseio.com",
  projectId: "affxx-copy",
  storageBucket: "affxx-copy.appspot.com",
  messagingSenderId: "763273288933",
  appId: "1:763273288933:web:d0083f5f6ab7284661c80c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ---------- INSCRIPTION ---------- */
const signupBtn = document.getElementById("signupBtn");
const email = document.getElementById("email");
const password = document.getElementById("password");
const message = document.getElementById("message");

signupBtn.addEventListener("click", async () => {
  message.textContent = "‚è≥ V√©rification...";
  try {
    // üî• Nettoyage complet avant tentative
    try { await signOut(auth); } catch {}
    indexedDB.deleteDatabase('firebaseLocalStorageDb');
    localStorage.clear();
    sessionStorage.clear();
    await new Promise(r => setTimeout(r, 500));

    // Cr√©ation du compte
    const userCred = await createUserWithEmailAndPassword(auth, email.value, password.value);
    const user = userCred.user;

    // Enregistrer profil minimal
    await set(ref(db, "users/" + user.uid), {
      pseudo: "Nouvel utilisateur",
      age: "",
      location: "",
      description: "",
      online: true,
      photos: []
    });

    message.textContent = "‚úÖ Compte cr√©√© avec succ√®s ! Redirection...";
    setTimeout(() => window.location.href = "page2.html", 1000);

  } catch (error) {
    console.error("Erreur Firebase:", error.code, error.message);

    if (error.code === "auth/email-already-in-use") {
      message.textContent = "‚ö†Ô∏è Adresse bloqu√©e localement. R√©essaye une fois, c‚Äôest lib√©r√© automatiquement ‚úÖ";
    } else if (error.code === "auth/invalid-email") {
      message.textContent = "‚ö†Ô∏è Adresse email invalide.";
    } else if (error.code === "auth/weak-password") {
      message.textContent = "‚ö†Ô∏è Mot de passe trop faible (min. 6 caract√®res).";
    } else {
      message.textContent = "‚ö†Ô∏è Erreur : " + error.message;
    }
  }
});
</script>
</body>
</html>
