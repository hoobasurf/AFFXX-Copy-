<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat avec Favoris</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  .container {
    display: flex;
    flex-grow: 1;
    background: #f0f0f0;
  }
  .chat-box {
    flex: 1 1 auto;
    max-width: 600px; /* réduction largeur */
    padding: 10px;
    display: flex;
    flex-direction: column;
    background: white;
  }
  .messages {
    flex-grow: 1;
    overflow-y: auto;
    margin-bottom: 10px;
  }
  .card {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 8px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    max-width: 100%;
    font-size: 14px;
  }
  .card img {
    width: 40px; /* réduction taille image */
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
  }
  .btn-fav {
    cursor: pointer;
    font-size: 22px;
    color: #aaa;
    user-select: none;
    border: none;
    background: transparent;
    padding: 0;
    margin-left: auto;
    transition: color 0.3s ease;
  }
  .btn-fav.active {
    color: gold;
  }
  .fav-bar {
    width: 180px;
    background: #fff;
    border-left: 1px solid #ccc;
    padding: 10px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  .fav-bar h2 {
    margin: 0 0 10px 0;
    font-size: 1.2em;
    border-bottom: 1px solid #ccc;
    padding-bottom: 6px;
  }
  .fav-list {
    flex-grow: 1;
    overflow-y: auto;
  }
  .fav-list .card {
    margin-bottom: 8px;
    font-size: 13px;
  }
  input#inputMsg {
    padding: 6px;
    font-size: 1em;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>

<div class="container">
  <div class="chat-box">
    <div class="messages" id="messages"></div>
    <input type="text" id="inputMsg" placeholder="Écrire un message puis appuyez sur Entrée" />
  </div>

  <div class="fav-bar" aria-label="Favoris">
    <h2>Favoris</h2>
    <div class="fav-list" id="favList"></div>
  </div>
</div>

<script>
  // Stockage messages et favoris par profil dans localStorage
  // Format de stockage: { messages: [{id, profile, text}], favIds: [id] }

  const messagesEl = document.getElementById('messages');
  const favListEl = document.getElementById('favList');
  const inputMsg = document.getElementById('inputMsg');

  // Exemple profils pour avatar (à remplacer ou étendre)
  const avatars = {
    Alice: "https://i.pravatar.cc/40?img=1",
    Bob: "https://i.pravatar.cc/40?img=2",
    Claire: "https://i.pravatar.cc/40?img=3",
  };

  // Charger depuis localStorage ou init
  let storage = JSON.parse(localStorage.getItem('chatAppData')) || {
    messages: [
      {id:1, profile:"Alice", text:"Bonjour !"},
      {id:2, profile:"Bob", text:"Salut, ça va ?"},
      {id:3, profile:"Claire", text:"Coucou tout le monde."}
    ],
    favIds: []
  };

  function saveStorage() {
    localStorage.setItem('chatAppData', JSON.stringify(storage));
  }

  function createCard(message) {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.id = message.id;
    card.dataset.profile = message.profile;

    const img = document.createElement('img');
    img.src = avatars[message.profile] || 'https://i.pravatar.cc/40?img=5';
    img.alt = message.profile;

    const content = document.createElement('div');
    content.innerHTML = `<strong>${message.profile}</strong><br>${message.text}`;

    const btnFav = document.createElement('button');
    btnFav.className = 'btn-fav';
    btnFav.setAttribute('aria-label', 'Ajouter aux favoris');
    btnFav.innerHTML = '☆';

    if (storage.favIds.includes(message.id)) {
      btnFav.classList.add('active');
      btnFav.innerHTML = '★';
    }

    btnFav.addEventListener('click', () => {
      const id = message.id;
      const idx = storage.favIds.indexOf(id);
      if (idx === -1) {
        storage.favIds.push(id);
        btnFav.classList.add('active');
        btnFav.innerHTML = '★';
      } else {
        storage.favIds.splice(idx, 1);
        btnFav.classList.remove('active');
        btnFav.innerHTML = '☆';
      }
      saveStorage();
      renderFavList();
    });

    card.appendChild(img);
    card.appendChild(content);
    card.appendChild(btnFav);

    return card;
  }

  function renderMessages() {
    messagesEl.innerHTML = '';
    // Affiche messages par profil uniquement
    const profiles = [...new Set(storage.messages.map(m => m.profile))];
    profiles.forEach(profile => {
      // filtre messages par profil
      storage.messages.filter(m => m.profile === profile)
        .forEach(msg => {
          messagesEl.appendChild(createCard(msg));
        });
    });
  }

  function renderFavList() {
    favListEl.innerHTML = '';
    storage.favIds.forEach(id => {
      const msg = storage.messages.find(m => m.id === id);
      if (msg) {
        const card = createCard(msg);
        // bouton favori non cliquable dans la liste des favoris (optionnel)
        card.querySelector('.btn-fav').style.display = 'none';
        favListEl.appendChild(card);
      }
    });
  }

  // Ajouter un nouveau message au profil 'Alice' par défaut
  inputMsg.addEventListener('keydown', e => {
    if (e.key === 'Enter' && inputMsg.value.trim() !== '') {
      const newId = storage.messages.length ? Math.max(...storage.messages.map(m=>m.id))+1 : 1;
      const newMsg = {
        id: newId,
        profile: 'Alice', // Par défaut
        text: inputMsg.value.trim()
      };
      storage.messages.push(newMsg);
      saveStorage();
      renderMessages();
      renderFavList();
      inputMsg.value = '';
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
  });

  // Initial render
  renderMessages();
  renderFavList();
</script>

</body>
</html>
