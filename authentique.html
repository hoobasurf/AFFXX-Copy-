<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Carrousel avec Fonctions</title>
<style>
  body {
    margin: 0; padding: 0; font-family: Arial, sans-serif; background: #222; color: #eee;
  }
  #carousel {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #carousel .items {
    display: flex;
    transition: transform 0.3s ease;
  }
  #carousel .item {
    min-width: 120px;
    margin: 0 10px;
    background: #444;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    user-select: none;
    cursor: pointer;
    position: relative;
  }
  #carousel .item.dragging {
    opacity: 0.6;
  }
  #mini-profile {
    position: fixed;
    top: 10px;
    right: 10px;
    width: 60px;
    height: 60px;
    background: #ff4081;
    border-radius: 50%;
    cursor: grab;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    user-select: none;
    z-index: 1000;
    color: white;
    font-size: 18px;
  }
  #mini-profile.dragging {
    cursor: grabbing;
    opacity: 0.8;
  }
  /* Juste pour montrer boutons - on garde à l’état brut */
  #buttons {
    margin: 20px;
    text-align: center;
  }
  button {
    margin: 0 10px;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="carousel">
  <div class="items" id="items-container">
    <div class="item" data-id="1">Profil 1</div>
    <div class="item" data-id="2">Profil 2</div>
    <div class="item" data-id="3">Profil 3</div>
    <div class="item" data-id="4">Profil 4</div>
    <div class="item" data-id="5">Profil 5</div>
  </div>
</div>

<div id="mini-profile" draggable="true" title="Déplace-moi">
  MP
</div>

<div id="buttons">
  <button id="likeBtn">J'aime</button>
  <button id="messageBtn">Message</button>
  <button id="showDataBtn">Afficher données</button>
</div>

<script>
  // ======== Mini-profile draggable + stockage position ========
  const miniProfile = document.getElementById('mini-profile');

  // Charge position stockée si existante
  const savedPos = localStorage.getItem('miniProfilePos');
  if (savedPos) {
    const pos = JSON.parse(savedPos);
    miniProfile.style.top = pos.top;
    miniProfile.style.left = pos.left;
    miniProfile.style.right = 'auto'; // supprime right si on set left
  }

  let offsetX, offsetY;
  let isDragging = false;

  miniProfile.addEventListener('mousedown', (e) => {
    isDragging = true;
    offsetX = e.clientX - miniProfile.getBoundingClientRect().left;
    offsetY = e.clientY - miniProfile.getBoundingClientRect().top;
    miniProfile.classList.add('dragging');
  });

  document.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      miniProfile.classList.remove('dragging');
      // Sauvegarde position
      localStorage.setItem('miniProfilePos', JSON.stringify({
        top: miniProfile.style.top,
        left: miniProfile.style.left
      }));
    }
  });

  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    let x = e.clientX - offsetX;
    let y = e.clientY - offsetY;

    // Limite dans fenêtre
    const winWidth = window.innerWidth;
    const winHeight = window.innerHeight;
    const elemWidth = miniProfile.offsetWidth;
    const elemHeight = miniProfile.offsetHeight;

    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x > winWidth - elemWidth) x = winWidth - elemWidth;
    if (y > winHeight - elemHeight) y = winHeight - elemHeight;

    miniProfile.style.left = x + 'px';
    miniProfile.style.top = y + 'px';
    miniProfile.style.right = 'auto'; // pour éviter conflit avec right css
  });

  // ======== Suppression mini-profile par appui long 5s ========
  let pressTimer = null;

  miniProfile.addEventListener('mousedown', () => {
    pressTimer = setTimeout(() => {
      // Supprime mini-profile
      miniProfile.style.display = 'none';
      localStorage.removeItem('miniProfilePos');
      alert("Mini-profil supprimé (appui long)");
    }, 5000);
  });
  miniProfile.addEventListener('mouseup', () => {
    clearTimeout(pressTimer);
  });
  miniProfile.addEventListener('mouseleave', () => {
    clearTimeout(pressTimer);
  });

  // ======== Gestion Likes + Messages avec stockage ========
  const likeBtn = document.getElementById('likeBtn');
  const messageBtn = document.getElementById('messageBtn');
  const showDataBtn = document.getElementById('showDataBtn');

  // On stocke les actions dans localStorage sous forme :
  // {likes: [{id, date}], messages: [{id, date}]}

  function getStoredData() {
    return JSON.parse(localStorage.getItem('userData') || '{"likes":[], "messages":[]}');
  }
  function saveStoredData(data) {
    localStorage.setItem('userData', JSON.stringify(data));
  }

  likeBtn.addEventListener('click', () => {
    const data = getStoredData();
    data.likes.push({id: Date.now(), date: new Date().toLocaleString()});
    saveStoredData(data);
    alert("Like ajouté !");
  });

  messageBtn.addEventListener('click', () => {
    const data = getStoredData();
    data.messages.push({id: Date.now(), date: new Date().toLocaleString()});
    saveStoredData(data);
    alert("Message ajouté !");
  });

  showDataBtn.addEventListener('click', () => {
    const data = getStoredData();
    alert(`Likes : ${data.likes.length}\nMessages : ${data.messages.length}`);
  });
</script>

</body>
</html>
