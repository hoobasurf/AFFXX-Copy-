<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion Authentique S√©rieuse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body {
      height:100%; width:100%;
      font-family:'Orbitron', sans-serif;
      background: url('planete-magique.jpg') no-repeat center center/cover;
      overflow:hidden; color:white;
    }
    .header {
      position:absolute;
      top:20px; left:20px;
      z-index:1000;
    }
    .btn-back {
      background:#fff; color:#000;
      padding:10px 15px; border-radius:8px;
      text-decoration:none;
    }
    .carousel-container {
      position: absolute;
      bottom: 0;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }
    .carousel {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    .card {
      flex: 0 0 auto;
      background: rgba(255,255,255,0.1);
      border: 2px solid #fff;
      border-radius: 10px;
      padding: 10px;
      width: 200px;
      cursor: pointer;
      text-align: center;
    }
    .card img {
      width: 100%;
      height: auto;
      border-radius: 8px;
    }
    .left-mini-profiles {
      position: absolute;
      top: 100px;
      left: 20px;
      z-index: 1000;
    }
    .left-mini-profiles img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-bottom: 10px;
      transition: transform 0.3s ease;
    }
    .left-mini-profiles img:hover {
      transform: scale(1.2);
    }
    .modal, .chat-modal, .photo-zoom {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    .chat-box {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
    }
    .chat-box textarea {
      width: 100%;
      height: 80px;
      border: none;
      padding: 10px;
      margin-bottom: 10px;
      resize: none;
    }
    .chat-box button {
      width: 100%;
      padding: 10px;
      background: #ff66cc;
      color: white;
      border: none;
      cursor: pointer;
    }
    .chat-modal.active {
      display: flex;
    }
  </style>
</head>
<body>

  <div class="header">
    <a href="page2.html" class="btn-back">&larr; Retour</a>
  </div>

  <div class="left-mini-profiles" id="leftMiniProfiles"></div>

  <div class="carousel-container fade-in">
    <div class="carousel" id="carousel">
      <div class="card" data-name="Sophie">
        <img src="sophie.jpg" alt="Sophie">
        <h3>Sophie</h3>
        <button class="btn-chat">üí¨</button>
        <button class="btn-like">‚ù§Ô∏è</button>
        <button class="btn-fav">‚≠ê</button>
      </div>
      <div class="card" data-name="Lucas">
        <img src="lucas.jpg" alt="Lucas">
        <h3>Lucas</h3>
        <button class="btn-chat">üí¨</button>
        <button class="btn-like">‚ù§Ô∏è</button>
        <button class="btn-fav">‚≠ê</button>
      </div>
    </div>
  </div>

  <div class="chat-modal" id="chatModal">
    <div class="chat-box">
      <textarea placeholder="√âcris un message..."></textarea>
      <button id="sendMessage">Envoyer</button>
    </div>
  </div>

  <script>
    (function(){
      const cards = document.querySelectorAll('.card');
      const chatModal = document.getElementById('chatModal');
      const sendBtn = document.getElementById('sendMessage');
      const textarea = chatModal.querySelector('textarea');
      const miniContainer = document.getElementById('leftMiniProfiles');

      document.querySelectorAll('.btn-chat').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          const name = btn.closest('.card').dataset.name;
          chatModal.classList.add('active');
          chatModal.dataset.user = name;
          textarea.value = '';
        });
      });

      document.querySelectorAll('.btn-like').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          const u = btn.closest('.card').dataset.name;
          let L = JSON.parse(localStorage.getItem('likes') || '{}');
          L[u] = (L[u] || 0) + 1;
          localStorage.setItem('likes', JSON.stringify(L));
          alert(u + " lik√© !");
        });
      });

      document.querySelectorAll('.btn-fav').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          const u = btn.closest('.card').dataset.name;
          let F = JSON.parse(localStorage.getItem('favoris') || '[]');
          if (!F.includes(u)) {
            F.push(u);
            localStorage.setItem('favoris', JSON.stringify(F));
          }
          alert(u + " ajout√© aux favoris !");
        });
      });

      sendBtn.addEventListener('click', () => {
        const msg = textarea.value.trim();
        if (!msg) return alert("√âcris un message...");
        const u = chatModal.dataset.user;
        const H = JSON.parse(localStorage.getItem('chatHistory') || '{}');
        if (!H[u]) H[u] = [];
        H[u].push({ content: msg, date: new Date().toLocaleString() });
        localStorage.setItem('chatHistory', JSON.stringify(H));
        chatModal.classList.remove('active');
        textarea.value = '';
        addMiniProfile(u);
      });

      function addMiniProfile(name) {
        const card = [...cards].find(c => c.dataset.name === name);
        if (!card) return;
        const src = card.querySelector('img').src;
        if ([...miniContainer.children].some(i => i.src === src)) return;
        const img = document.createElement('img');
        img.src = src;
        img.alt = name;
        makeDraggable(img);
        setupLongPress(img, name);
        miniContainer.prepend(img);
      }

      function makeDraggable(el) {
        el.style.position = 'absolute'; el.style.cursor = 'move';
        let dx, dy, dragging = false;
        el.addEventListener('mousedown', e => {
          dragging = true;
          dx = e.clientX - el.getBoundingClientRect().left;
          dy = e.clientY - el.getBoundingClientRect().top;
        });
        document.addEventListener('mousemove', e => {
          if (!dragging) return;
          let x = e.clientX - dx, y = e.clientY - dy;
          el.style.left = x + 'px'; el.style.top = y + 'px';
        });
        document.addEventListener('mouseup', () => dragging = false);
      }

      function setupLongPress(el, name) {
        let t;
        el.addEventListener('mousedown', () => {
          t = setTimeout(() => {
            if (confirm(`Supprimer mini‚Äëprofil "${name}" ?`)) el.remove();
          }, 5000);
        });
        el.addEventListener('mouseup', () => clearTimeout(t));
        el.addEventListener('mouseleave', () => clearTimeout(t));
      }

      cards.forEach(c => {
        let t;
        c.addEventListener('mousedown', () => {
          t = setTimeout(() => {
            if (confirm(`Supprimer profil ${c.dataset.name} ?`)) c.remove();
          }, 5000);
        });
        c.addEventListener('mouseup', () => clearTimeout(t));
        c.addEventListener('mouseleave', () => clearTimeout(t));
      });
    })();
  </script>
</body>
</html>
