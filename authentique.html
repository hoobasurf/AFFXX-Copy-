<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Messagerie avec Profils</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f0f0;
  }
  #container {
    display: flex;
    height: 100vh;
  }
  #miniProfiles {
    width: 120px;
    background: #fff;
    border-right: 1px solid #ccc;
    overflow-y: auto;
  }
  .mini-profile {
    cursor: pointer;
    padding: 10px;
    border-bottom: 1px solid #eee;
    text-align: center;
  }
  .mini-profile img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
  }
  .mini-profile .fav-star {
    color: gold;
    font-size: 18px;
  }

  #profiles {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }
  .profile {
    background: #fff;
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 8px;
    position: relative;
  }
  .profile img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    float: left;
    margin-right: 15px;
    object-fit: cover;
  }
  .profile h3 {
    margin: 0 0 10px 0;
  }
  .profile p {
    margin: 0 0 10px 0;
    clear: both;
  }
  .buttons {
    display: flex;
    gap: 10px;
  }
  button {
    cursor: pointer;
    padding: 6px 10px;
    border: none;
    border-radius: 5px;
    font-size: 16px;
  }
  .btn-like {
    background: #ff4d4d;
    color: white;
  }
  .btn-star {
    background: #ffcc00;
    color: black;
  }
  .btn-chat {
    background: #3399ff;
    color: white;
  }
  .btn-delete {
    background: #999;
    color: white;
    position: absolute;
    top: 10px;
    right: 10px;
  }

  /* Modales et fenêtres agrandies */
  .modal, .expanded-profile, #chatModal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    z-index: 1000;
  }
  .modal-content, .chat-content, .expanded-profile > div {
    background: white;
    border-radius: 10px;
    padding: 20px;
    position: relative;
    max-width: 400px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }

  /* Close buttons (croix) */
  .close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    font-weight: bold;
    color: #ff69b4; /* rose vif */
    cursor: pointer;
    user-select: none;
    z-index: 1001;
  }

  /* Styles spécifiques fenêtres agrandies */
  #expandedProfile {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #expandedProfile > div {
    text-align: center;
  }
  #expandedProfile img {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
  }
  #expandedProfile .buttons {
    justify-content: center;
  }

  /* Chat modal */
  #chatModal .chat-content {
    max-width: 500px;
  }
  #chatMessages {
    height: 300px;
    border: 1px solid #ccc;
    overflow-y: auto;
    margin-bottom: 10px;
    padding: 10px;
  }
  #chatInput {
    width: 100%;
    padding: 8px;
    font-size: 16px;
  }
</style>
</head>
<body>

<div id="container">
  <!-- Miniatures profils (uniquement profils avec messages ou favoris) -->
  <div id="miniProfiles"></div>

  <!-- Liste profils complète -->
  <div id="profiles"></div>
</div>

<!-- Profil agrandi -->
<div id="expandedProfile" class="expanded-profile">
  <div>
    <span id="expandedClose" class="close">&times;</span>
    <img id="expandedImg" src="" alt="Photo" />
    <h2 id="expandedName"></h2>
    <p id="expandedDesc"></p>
    <div class="buttons">
      <button id="expandedLikeBtn" class="btn-like">&#10084;</button>
      <button id="expandedChatBtn" class="btn-chat">&#9993;</button>
      <button id="expandedStarBtn" class="btn-star">&#9733;</button>
    </div>
  </div>
</div>

<!-- Modal générique -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span id="modalClose" class="close">&times;</span>
    <p id="modalText"></p>
  </div>
</div>

<!-- Chat modal -->
<div id="chatModal" class="modal">
  <div class="chat-content">
    <span id="chatClose" class="close">&times;</span>
    <h3 id="chatWithName"></h3>
    <div id="chatMessages"></div>
    <input id="chatInput" type="text" placeholder="Écrire un message..." />
  </div>
</div>

<script>
  // Données profils exemples
  const profiles = [
    {
      id: 1,
      name: "Alice",
      desc: "Amatrice de voyages et de musique.",
      photo: "https://randomuser.me/api/portraits/women/68.jpg",
      likes: 0,
      favori: false,
      messages: []
    },
    {
      id: 2,
      name: "Bob",
      desc: "Passionné de sport et de cuisine.",
      photo: "https://randomuser.me/api/portraits/men/45.jpg",
      likes: 0,
      favori: false,
      messages: []
    },
    {
      id: 3,
      name: "Clara",
      desc: "Lecture et écriture, toujours curieuse.",
      photo: "https://randomuser.me/api/portraits/women/65.jpg",
      likes: 0,
      favori: false,
      messages: []
    }
  ];

  let currentExpandedProfileId = null;
  let currentChatProfileId = null;

  // Affiche les miniatures (uniquement profils avec messages ou favoris)
  function renderMiniProfiles() {
    const container = document.getElementById('miniProfiles');
    container.innerHTML = '';
    // Filtrer profils avec messages ou favoris
    const filtered = profiles.filter(p => p.favori || p.messages.length > 0);
    if(filtered.length === 0) {
      container.innerHTML = '<p style="padding:10px; font-size:14px; color:#666;">Aucune conversation</p>';
      return;
    }
    filtered.forEach(profile => {
      const div = document.createElement('div');
      div.className = 'mini-profile';
      div.title = profile.name;
      div.innerHTML = `
        <img src="${profile.photo}" alt="${profile.name}" />
        ${profile.favori ? '<div class="fav-star">&#9733;</div>' : ''}
      `;
      div.addEventListener('click', () => {
        openExpandedProfile(profile.id);
      });
      container.appendChild(div);
    });
  }

  // Affiche tous les profils dans la liste principale
  function renderProfiles() {
    const container = document.getElementById('profiles');
    container.innerHTML = '';
    profiles.forEach(profile => {
      const div = document.createElement('div');
      div.className = 'profile';
      div.dataset.id = profile.id;
      div.innerHTML = `
        <img src="${profile.photo}" alt="${profile.name}" />
        <h3>${profile.name}</h3>
        <p>${profile.desc}</p>
        <div class="buttons">
          <button class="btn-like">&#10084; (${profile.likes})</button>
          <button class="btn-star">${profile.favori ? '&#9733;' : '☆'}</button>
          <button class="btn-chat">&#9993;</button>
        </div>
        <button class="btn-delete" title="Supprimer ce profil">✖</button>
      `;
      container.appendChild(div);

      // Événements boutons
      const likeBtn = div.querySelector('.btn-like');
      const starBtn = div.querySelector('.btn-star');
      const chatBtn = div.querySelector('.btn-chat');
      const delBtn = div.querySelector('.btn-delete');

      likeBtn.addEventListener('click', () => {
        profile.likes++;
        renderProfiles();
      });

      starBtn.addEventListener('click', () => {
        profile.favori = !profile.favori;
        renderProfiles();
        renderMiniProfiles();
      });

      chatBtn.addEventListener('click', () => {
        openChat(profile.id);
      });

      delBtn.addEventListener('click', () => {
        if(confirm(`Voulez-vous supprimer le profil de ${profile.name} ?`)) {
          // Supprimer profil du tableau
          const index = profiles.findIndex(p => p.id === profile.id);
          if(index > -1) profiles.splice(index, 1);
          renderProfiles();
          renderMiniProfiles();
          closeExpandedProfile();
          closeChat();
        }
      });

      // Cliquer sur la zone principale ouvre profil agrandi
      div.addEventListener('click', (e) => {
        if(!e.target.closest('button')) {
          openExpandedProfile(profile.id);
        }
      });
    });
  }

  // Ouvrir profil agrandi
  function openExpandedProfile(id) {
    const profile = profiles.find(p => p.id === id);
    if(!profile) return;
    currentExpandedProfileId = id;
    document.getElementById('expandedImg').src = profile.photo;
    document.getElementById('expandedName').textContent = profile.name;
    document.getElementById('expandedDesc').textContent = profile.desc;
    document.getElementById('expandedLikeBtn').textContent = `❤️ (${profile.likes})`;
    document.getElementById('expandedStarBtn').innerHTML = profile.favori ? '&#9733;' : '☆';
    document.getElementById('expandedProfile').style.display = 'flex';
  }

  // Fermer profil agrandi
  function closeExpandedProfile() {
    document.getElementById('expandedProfile').style.display = 'none';
    currentExpandedProfileId = null;
  }

  // Ouvrir chat
  function openChat(id) {
    const profile = profiles.find(p => p.id === id);
    if(!profile) return;
    currentChatProfileId = id;
    document.getElementById('chatWithName').textContent = `Chat avec ${profile.name}`;
    renderChatMessages();
    document.getElementById('chatModal').style.display = 'flex';
  }

  // Fermer chat
  function closeChat() {
    document.getElementById('chatModal').style.display = 'none';
    currentChatProfileId = null;
    document.getElementById('chatInput').value = '';
  }

  // Afficher messages dans chat
  function renderChatMessages() {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML = '';
    if(currentChatProfileId === null) return;
    const profile = profiles.find(p => p.id === currentChatProfileId);
    if(!profile) return;
    profile.messages.forEach(msg => {
      const div = document.createElement('div');
      div.textContent = msg;
      div.style.marginBottom = '8px';
      chatMessages.appendChild(div);
    });
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  // Envoyer message dans chat
  document.getElementById('chatInput').addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      const text = e.target.value.trim();
      if(text && currentChatProfileId !== null) {
        const profile = profiles.find(p => p.id === currentChatProfileId);
        if(profile) {
          profile.messages.push(text);
          e.target.value = '';
          renderChatMessages();
          renderMiniProfiles();
        }
      }
    }
  });

  // Gestion croix fermeture modales
  document.getElementById('modalClose').addEventListener('click', () => {
    document.getElementById('modal').style.display = 'none';
  });
  document.getElementById('chatClose').addEventListener('click', closeChat);
  document.getElementById('expandedClose').addEventListener('click', closeExpandedProfile);

  // Fermer profil agrandi ou modales en cliquant sur fond (hors contenu)
  document.getElementById('expandedProfile').addEventListener('click', e => {
    if(e.target === e.currentTarget) closeExpandedProfile();
  });
  document.getElementById('chatModal').addEventListener('click', e => {
    if(e.target === e.currentTarget) closeChat();
  });
  document.getElementById('modal').addEventListener('click', e => {
    if(e.target === e.currentTarget) {
      document.getElementById('modal').style.display = 'none';
    }
  });

  // Initial render
  renderProfiles();
  renderMiniProfiles();

</script>

</body>
</html>
