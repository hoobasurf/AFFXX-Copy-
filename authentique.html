<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion Authentique S√©rieuse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">

  <style>
  /* ... Ton CSS complet ... (inchang√© sauf ceci) */

  * { box-sizing: border-box; margin:0; padding:0; }
  html, body {
    height:100%; width:100%;
    font-family: 'Orbitron', sans-serif;
    background: url('planete-magique.jpg') no-repeat center center/cover;
    overflow: hidden; color: white;
  }
  body::before {
    content:""; position:fixed; top:0; left:0;
    width:100%; height:100%;
    background: radial-gradient(circle at center, rgba(255,0,255,0.05), transparent 70%);
    z-index:1; pointer-events:none;
    animation: floatStars 60s linear infinite;
  }
  @keyframes floatStars { 0% {transform: translateY(0);} 100% {transform: translateY(-10px);} }
  .header {
    position: relative; z-index:2;
    padding: 20px;
  }
  .btn-back {
    position: absolute; top:20px; left:20px;
    color: #ff66cc; font-size:1.5em;
    cursor:pointer; text-decoration:none;
    transition: transform .2s;
  }
  .btn-back:hover { transform: scale(1.2); }
  .carousel-container {
    z-index:2;
    position: relative;
    width:100%; height:calc(100% - 60px);
    overflow: hidden;
    display: flex;
    align-items:center;
  }
  .carousel {
    display:flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    gap:40px;
    padding:40px;
  }
  .carousel::-webkit-scrollbar { display:none; }
  .card {
    scroll-snap-align: center;
    flex: 0 0 150px;
    background: rgba(0,0,0,0.5);
    border-radius: 16px;
    padding: 15px;
    text-align: center;
    transition: transform .3s, box-shadow .3s;
    cursor: pointer;
    position: relative;
  }
  .card img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 3px solid;
  }
  .girl img { border-color:#ff66cc; box-shadow:0 0 12px #ff66cc; }
  .boy img { border-color:#9933ff; box-shadow:0 0 12px #9933ff; }
  .name { font-size:1.1em; margin-bottom:5px;}
  .btns {
    display:flex;
    justify-content: center;
    gap: 8px;
    margin-top: 6px;
  }
  .btn-like, .btn-chat, .btn-fav {
    width:30px; height:30px;
    border-radius:50%;
    background-color:rgba(255,255,255,0.1);
    border:1px solid #ff66cc;
    color:#ff66cc;
    display:flex; align-items:center; justify-content:center;
    font-size:1em;
    cursor:pointer;
    transition: transform .2s, background-color .3s, color .3s;
    user-select:none;
  }
  .btn-like:hover, .btn-chat:hover, .btn-fav:hover { transform: scale(1.2); }
  /* Bouton favoris en jaune quand actif */
  .btn-fav.active {
    background-color: #ffea00;
    border-color: #ffea00;
    color: #333;
    transform: scale(1.3);
  }
  .card.center {
    transform: scale(1.1);
    box-shadow: 0 0 20px #ff00ff;
  }
  /* Mini‚Äëprofil gauche apr√®s message */
  .left-mini-profiles {
    position: fixed;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 5;
  }
  .left-mini-profiles img {
    width:50px; height:50px;
    border-radius:50%;
    border:2px solid #ff66cc;
    object-fit:cover;
    cursor:pointer;
    box-shadow:0 0 8px #ff66cc;
    transition:transform .2s;
    user-select:none;
    touch-action: none;
    position: relative; /* for drag */
  }
  .left-mini-profiles img:hover { transform: scale(1.2); }

  /* Modal profil */
  .modal {
    display:none; position:fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.8);
    align-items:center; justify-content:center;
    z-index:10;
  }
  .modal.active { display:flex; }
  .modal-content {
    background: rgba(0,0,0,0.7);
    padding:20px; border-radius:12px;
    width:90%; max-width:400px;
    text-align:center; position:relative;
    max-height:90vh; overflow-y:auto;
  }
  .modal-content h2 { margin-bottom:10px; color:#ff66cc;}
  .modal-content p { margin-bottom:8px; color:#ddd; font-size:0.95em;}
  .modal-close {
    position:absolute; top:10px; right:10px;
    font-size:1.3em; color:#ff66cc;
    cursor:pointer;
  }
  .photo-gallery {
    display:flex; justify-content:center; flex-wrap: wrap; gap: 8px; margin-top: 10px;
  }
  .photo-gallery img {
    width: 80px; height: 80px;
    border-radius: 12px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
  }
  .photo-gallery img:hover {
    border-color: #ff66cc;
  }

  /* Modal chat (copie style carte profil pour la modale) */
  #chatModal .modal-content {
    max-width: 350px;
    background: rgba(0,0,0,0.7);
    border-radius: 16px;
    padding: 15px;
    text-align: left;
    font-size: 1em;
    color: #ddd;
  }
  #chatModal .modal-header {
    font-weight: bold;
    color: #ff66cc;
    margin-bottom: 10px;
    font-size: 1.3em;
    text-align: center;
  }
  #chatModal textarea {
    width: 100%;
    height: 80px;
    margin-bottom: 10px;
    border-radius: 10px;
    border: 1px solid #ff66cc;
    background: transparent;
    color: #fff;
    padding: 8px;
    resize: none;
    font-family: 'Orbitron', sans-serif;
  }
  #chatModal button {
    background: #ff66cc;
    color: #222;
    border: none;
    padding: 8px 12px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
  }
  #chatModal button:hover {
    background: #ff33ff;
  }
  </style>
</head>
<body>

  <div class="header">
    <a href="page2.html" class="btn-back">&larr; Retour</a>
  </div>

  <div class="left-mini-profiles" id="leftMiniProfiles">
    <!-- Mini-profil s‚Äôaffiche ici apr√®s message -->
  </div>

  <div class="carousel-container fade-in">
    <div class="carousel" id="carousel">
      <div class="card girl" data-name="Sophie" data-age="28" data-lieu="Paris" data-desc="Passionn√©e par l‚Äôastronomie et les romans SF." data-gallery="47,49,51" data-msg="false">
        <img src="https://i.pravatar.cc/150?img=47" alt="Sophie"/>
        <div class="name">Sophie</div>
        <div class="btns">
          <button class="btn-like" title="J‚Äôaime">‚ù§Ô∏è</button>
          <button class="btn-chat" title="Chat">üí¨</button>
          <button class="btn-fav" title="Favoris">‚òÖ</button>
        </div>
      </div>
      <div class="card boy" data-name="Marc" data-age="35" data-lieu="Lyon" data-desc="Amateur de musculation et fan de manga." data-gallery="14,20,22" data-msg="false">
        <img src="https://i.pravatar.cc/150?img=14" alt="Marc"/>
        <div class="name">Marc</div>
        <div class="btns">
          <button class="btn-like" title="J‚Äôaime">‚ù§Ô∏è</button>
          <button class="btn-chat" title="Chat">üí¨</button>
          <button class="btn-fav" title="Favoris">‚òÖ</button>
        </div>
      </div>
      <div class="card girl" data-name="Clara" data-age="23" data-lieu="Marseille" data-desc="Danseuse et amatrice de th√© vert." data-gallery="33,37,39" data-msg="false">
        <img src="https://i.pravatar.cc/150?img=33" alt="Clara"/>
        <div class="name">Clara</div>
        <div class="btns">
          <button class="btn-like" title="J‚Äôaime">‚ù§Ô∏è</button>
          <button class="btn-chat" title="Chat">üí¨</button>
          <button class="btn-fav" title="Favoris">‚òÖ</button>
        </div>
      </div>
      <!-- Ajoute d‚Äôautres profils ici -->
    </div>
  </div>

  <!-- Modal profil complet -->
  <div class="modal" id="profileModal" aria-hidden="true">
    <div class="modal-content">
      <span class="modal-close" id="modalClose">&times;</span>
      <h2 id="modalName"></h2>
      <p id="modalAgeLieu"></p>
      <p id="modalDesc"></p>
      <div class="photo-gallery" id="modalGallery"></div>
    </div>
  </div>

  <!-- Modal chat -->
  <div class="modal" id="chatModal" aria-hidden="true">
    <div class="modal-content">
      <span class="modal-close" id="chatClose">&times;</span>
      <div class="modal-header" id="chatHeader"></div>
      <textarea id="chatInput" placeholder="√âcris ton message..."></textarea>
      <button id="sendChatBtn">Envoyer</button>
    </div>
  </div>

<script>
  // R√©cup√©rations globales
  const cards = document.querySelectorAll('.card');
  const profileModal = document.getElementById('profileModal');
  const modalClose = document.getElementById('modalClose');
  const modalName = document.getElementById('modalName');
  const modalAgeLieu = document.getElementById('modalAgeLieu');
  const modalDesc = document.getElementById('modalDesc');
  const modalGallery = document.getElementById('modalGallery');

  const chatModal = document.getElementById('chatModal');
  const chatClose = document.getElementById('chatClose');
  const chatHeader = document.getElementById('chatHeader');
  const chatInput = document.getElementById('chatInput');
  const sendChatBtn = document.getElementById('sendChatBtn');

  const leftMiniProfiles = document.getElementById('leftMiniProfiles');

  // Stockage des mini profils affich√©s
  let miniProfiles = [];

  // Fonction pour ouvrir le profil complet
  function openProfile(card) {
    const name = card.dataset.name;
    const age = card.dataset.age;
    const lieu = card.dataset.lieu;
    const desc = card.dataset.desc;
    const galleryIds = card.dataset.gallery.split(',');

    modalName.textContent = name;
    modalAgeLieu.textContent = `${age} ans, ${lieu}`;
    modalDesc.textContent = desc;

    // Vider galerie pr√©c√©dente
    modalGallery.innerHTML = '';
    galleryIds.forEach(id => {
      const img = document.createElement('img');
      img.src = `https://i.pravatar.cc/150?img=${id.trim()}`;
      img.alt = `${name} photo`;
      modalGallery.appendChild(img);
    });

    profileModal.classList.add('active');
    profileModal.setAttribute('aria-hidden', 'false');
  }

  // Fermeture modale profil
  modalClose.addEventListener('click', () => {
    profileModal.classList.remove('active');
    profileModal.setAttribute('aria-hidden', 'true');
  });

  // Fermeture modale chat
  chatClose.addEventListener('click', () => {
    chatModal.classList.remove('active');
    chatModal.setAttribute('aria-hidden', 'true');
  });

  // Clic sur bouton chat : ouvre modale chat et pr√©pare envoi message
  cards.forEach(card => {
    // Ouvrir profil au clic sur image ou nom
    card.querySelector('img').addEventListener('click', () => openProfile(card));
    card.querySelector('.name').addEventListener('click', () => openProfile(card));

    // Bouton chat
    const btnChat = card.querySelector('.btn-chat');
    btnChat.addEventListener('click', () => {
      chatHeader.textContent = `Chat avec ${card.dataset.name}`;
      chatInput.value = '';
      chatModal.classList.add('active');
      chatModal.setAttribute('aria-hidden', 'false');

      // Focus textarea
      setTimeout(() => chatInput.focus(), 100);

      // Garder la carte cibl√©e pour envoi message
      chatModal.currentCard = card;
    });
  });

  // Envoi du message chat
  sendChatBtn.addEventListener('click', () => {
    const msg = chatInput.value.trim();
    if (!msg) return alert("√âcris un message avant d'envoyer.");

    const card = chatModal.currentCard;
    if (!card) return;

    // Marquer le profil comme "message envoy√©"
    card.dataset.msg = "true";

    // Ajouter mini-profil √† gauche si pas d√©j√† l√†
    if (!miniProfiles.includes(card)) {
      miniProfiles.push(card);
      addMiniProfile(card);
    }

    // Fermer la modale chat
    chatModal.classList.remove('active');
    chatModal.setAttribute('aria-hidden', 'true');

    alert(`Message envoy√© √† ${card.dataset.name} :\n${msg}`);
  });

 let dragging = false;
let pos = { x: 0, y: 0, left: 0, top: 0 };
const el = document.querySelector('.mini-profile'); // adapte selon ton s√©lecteur

el.addEventListener('mousedown', dragStart);
el.addEventListener('touchstart', dragStart, { passive: false });

function dragStart(e) {
  e.preventDefault();
  dragging = true;

  const rect = el.getBoundingClientRect();
  pos = {
    x: e.type === 'touchstart' ? e.touches[0].clientX : e.clientX,
    y: e.type === 'touchstart' ? e.touches[0].clientY : e.clientY,
    left: rect.left - el.parentElement.getBoundingClientRect().left,
    top: rect.top - el.parentElement.getBoundingClientRect().top,
  };

  window.addEventListener('mousemove', dragMove);
  window.addEventListener('touchmove', dragMove, { passive: false });
  window.addEventListener('mouseup', dragEnd);
  window.addEventListener('touchend', dragEnd);
}

function dragMove(e) {
  if (!dragging) return;
  e.preventDefault();

  const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
  const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

  const dx = clientX - pos.x;
  const dy = clientY - pos.y;

  let newLeft = pos.left + dx;
  let newTop = pos.top + dy;

  const parentRect = el.parentElement.getBoundingClientRect();
  const elRect = el.getBoundingClientRect();

  // Limites horizontales (dans le parent)
  if (newLeft < 0) newLeft = 0;
  if (newLeft + elRect.width > parentRect.width) newLeft = parentRect.width - elRect.width;

  // Limites verticales (dans le parent)
  if (newTop < 0) newTop = 0;
  if (newTop + elRect.height > parentRect.height) newTop = parentRect.height - elRect.height;

  el.style.position = 'absolute';
  el.style.left = newLeft + 'px';
  el.style.top = newTop + 'px';
}

function dragEnd() {
  dragging = false;
  window.removeEventListener('mousemove', dragMove);
  window.removeEventListener('touchmove', dragMove);
  window.removeEventListener('mouseup', dragEnd);
  window.removeEventListener('touchend', dragEnd);
}
    });
  });
</script>

</body>
</html>
