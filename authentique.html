<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion Authentique Sérieuse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body {
      height:100%; width:100%;
      font-family: 'Orbitron', sans-serif;
      background: url('planete-magique.jpg') no-repeat center center/cover;
      overflow: hidden; color: white;
    }
    body::before {
      content:""; position:fixed; top:0; left:0;
      width:100%; height:100%;
      background: radial‑gradient(circle at center, rgba(255,0,255,0.05), transparent 70%);
      z‑index:1; pointer-events:none;
      animation: floatStars 60s linear infinite;
    }
    @keyframes floatStars { 0% {transform: translateY(0);} 100% {transform: translateY(-10px);} }
    /* Ton CSS existant ignoré ici pour la brièveté */
    .left‑mini‑profiles {
      position: fixed; top:50%; left:10px;
      transform: translateY(-50%);
      display: flex; flex-direction:column; gap:12px;
      z-index:5;
    }
    .left‑mini‑profiles img {
      width:50px; height:50px; border-radius:50%;
      border:2px solid #ff66cc; object-fit:cover;
      cursor:pointer; box-shadow:0 0 8px #ff66cc;
      transition: transform .2s;
    }
    .left‑mini‑profiles img.dragging {
      opacity: 0.5;
    }
    .left‑mini‑profiles img:hover { transform: scale(1.2); }

    #chatContainer {
      display: none;
      position: fixed;
      left: 80px; top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.8);
      color: #ff66cc;
      width: 280px; max-height:400px;
      border-radius:12px;
      padding:10px;
      z-index:20;
      font-family: 'Orbitron', sans-serif;
      display: flex; flex-direction: column;
    }
    #chatContainer h3 { margin:0 0 8px 0; }
    #messagesList {
      flex:1; overflow-y:auto; margin-bottom:8px; padding-right:6px;
    }
    #messagesList div {
      background:#ff66cc; color:#222; padding:6px 10px;
      margin-bottom:6px; border-radius:12px; align-self:flex-end;
      word-wrap: break-word;
    }
    #inputWrapper { display:flex; gap:6px; }
    #inputMessage {
      flex:1; padding:6px 8px; border-radius:8px;
      border:1px solid #ff66cc; background:transparent;
      color:#ff66cc; font-size:1em; outline:none;
    }
    #sendButton {
      padding:6px 12px; border-radius:8px; border:none;
      background:#ff66cc; color:#222; cursor:pointer;
      font-weight:bold;
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="page2.html" class="btn-back">&larr; Retour</a>
  </div>

  <div class="left‑mini‑profiles" id="leftMiniProfiles"></div>

  <div class="carousel-container fade-in">
    <div class="carousel" id="carousel">
      <!-- tes cartes ici, inchangées -->
    </div>
  </div>

  <div class="modal" id="profileModal">
    <!-- ta modal existante -->
  </div>

  <!-- Chat container : ajouté -->
  <div id="chatContainer" aria-live="polite">
    <h3>Chat</h3>
    <div id="messagesList"></div>
    <div id="inputWrapper">
      <input type="text" id="inputMessage" placeholder="Écrire un message..." />
      <button id="sendButton">Envoyer</button>
    </div>
  </div>

  <script>
    const carousel = document.getElementById('carousel');
    const leftMini = document.getElementById('leftMiniProfiles');
    const chatContainer = document.getElementById('chatContainer');
    const messagesList = document.getElementById('messagesList');
    const inputMessage = document.getElementById('inputMessage');
    const sendButton = document.getElementById('sendButton');
    let activeMini = null;
    const chatStore = {};

    carousel.querySelectorAll('.btn-chat').forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation();
        const card = btn.closest('.card');
        const name = card.dataset.name;
        const imgSrc = card.querySelector('img').src;
        if ([...leftMini.children].some(c => c.alt === name)) return;

        const img = document.createElement('img');
        img.src = imgSrc; img.alt = name; img.title = name;
        img.draggable = true;
        leftMini.appendChild(img);

        img.addEventListener('click', () => {
          activeMini = img;
          chatContainer.style.display = 'flex';
          chatContainer.querySelector('h3').textContent = `Chat avec ${name}`;
          messagesList.innerHTML = '';
          (chatStore[name] || []).forEach(m => {
            const div = document.createElement('div');
            div.textContent = m;
            messagesList.appendChild(div);
          });
          inputMessage.value = '';
          inputMessage.focus();
        });

        let holdTimeout;
        img.addEventListener('mousedown', () => {
          holdTimeout = setTimeout(() => {
            leftMini.removeChild(img);
            if (activeMini === img) {
              chatContainer.style.display = 'none';
              activeMini = null;
            }
          }, 3000);
        });
        img.addEventListener('mouseup', () => clearTimeout(holdTimeout));
        img.addEventListener('mouseleave', () => clearTimeout(holdTimeout));

        img.addEventListener('dragstart', e => {
          img.classList.add('dragging');
          e.dataTransfer.setData('text/plain','');
        });
        img.addEventListener('dragend', () => img.classList.remove('dragging'));
      });
    });

    leftMini.addEventListener('dragover', e => {
      e.preventDefault();
      const dragging = leftMini.querySelector('.dragging');
      const after = getDragAfter(leftMini, e.clientY);
      if (!after) leftMini.appendChild(dragging);
      else leftMini.insertBefore(dragging, after);
    });

    function getDragAfter(container, y) {
      return [...container.querySelectorAll('img:not(.dragging)')]
        .reduce((closest, c) => {
          const box = c.getBoundingClientRect();
          const offset = y - box.top - box.height / 2;
          if (offset < 0 && offset > closest.offset) return { offset, element: c };
          return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function sendMessage() {
      if (!activeMini) return;
      const text = inputMessage.value.trim();
      if (!text) return;
      const name = activeMini.alt;
      chatStore[name] = chatStore[name] || [];
      chatStore[name].push(text);
      const div = document.createElement('div');
      div.textContent = text;
      messagesList.appendChild(div);
      inputMessage.value = '';
      messagesList.scrollTop = messagesList.scrollHeight;
    }

    sendButton.addEventListener('click', sendMessage);
    inputMessage.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
