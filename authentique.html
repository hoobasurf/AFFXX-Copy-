<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Profils</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .card {
      width: 250px;
      background: #222;
      margin: 10px;
      border-radius: 8px;
      overflow: hidden;
      display: inline-block;
      vertical-align: top;
      position: relative;
    }
    .card img {
      width: 100%;
      height: auto;
    }
    .card .infos {
      padding: 10px;
    }
    .card .actions {
      display: flex;
      justify-content: space-around;
      padding: 10px;
    }
    .card .actions button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: white;
    }
    .card .actions .favorite.active {
      color: yellow;
    }
    .chat-box {
      position: fixed;
      right: 0;
      bottom: 0;
      width: 300px;
      max-height: 400px;
      background: #333;
      border-left: 2px solid #555;
      display: none;
      flex-direction: column;
    }
    .chat-header {
      background: #444;
      padding: 10px;
      font-weight: bold;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }
    .chat-input {
      display: flex;
    }
    .chat-input input {
      flex: 1;
      padding: 10px;
      border: none;
      background: #222;
      color: white;
    }
    .chat-input button {
      background: #555;
      border: none;
      color: white;
      padding: 10px;
    }
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 80px;
      background: #000;
      overflow-y: auto;
      padding-top: 10px;
    }
    .mini-profile {
      width: 60px;
      height: 60px;
      margin: 10px auto;
      border-radius: 50%;
      overflow: hidden;
      cursor: move;
      border: 2px solid #444;
    }
    .mini-profile img {
      width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar"></div>

  <div class="card" data-id="user1">
    <img src="https://via.placeholder.com/250x150" />
    <div class="infos">
      <h3>Nom 1</h3>
      <p>Description rapide</p>
    </div>
    <div class="actions">
      <button class="like">‚ù§Ô∏è</button>
      <button class="message">üí¨</button>
      <button class="favorite">‚òÜ</button>
    </div>
  </div>

  <div class="card" data-id="user2">
    <img src="https://via.placeholder.com/250x150" />
    <div class="infos">
      <h3>Nom 2</h3>
      <p>Autre description</p>
    </div>
    <div class="actions">
      <button class="like">‚ù§Ô∏è</button>
      <button class="message">üí¨</button>
      <button class="favorite">‚òÜ</button>
    </div>
  </div>

  <div class="chat-box" id="chatBox">
    <div class="chat-header" id="chatHeader">Chat</div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="√âcris un message..." />
      <button onclick="sendMessage()">Envoyer</button>
    </div>
  </div>

  <script>
    const sidebar = document.getElementById("sidebar");
    const chatBox = document.getElementById("chatBox");
    const chatHeader = document.getElementById("chatHeader");
    const chatMessages = document.getElementById("chatMessages");
    let currentChatId = null;

    document.querySelectorAll(".favorite").forEach(btn => {
      btn.addEventListener("click", () => {
        const card = btn.closest(".card");
        const id = card.dataset.id;
        btn.classList.toggle("active");
        btn.textContent = btn.classList.contains("active") ? "‚òÖ" : "‚òÜ";
        if (btn.classList.contains("active")) {
          if (!document.querySelector(`#mini-${id}`)) {
            const mini = document.createElement("div");
            mini.className = "mini-profile";
            mini.id = `mini-${id}`;
            mini.setAttribute("draggable", true);
            mini.innerHTML = card.querySelector("img").outerHTML;
            mini.addEventListener("click", () => openChat(id, card.querySelector("h3").textContent));
            enableDrag(mini);
            sidebar.appendChild(mini);
          }
        } else {
          const mini = document.querySelector(`#mini-${id}`);
          if (mini) sidebar.removeChild(mini);
        }
      });
    });

    document.querySelectorAll(".message").forEach(btn => {
      btn.addEventListener("click", () => {
        const card = btn.closest(".card");
        const id = card.dataset.id;
        openChat(id, card.querySelector("h3").textContent);
      });
    });

    function openChat(id, name) {
      currentChatId = id;
      chatHeader.textContent = "Chat avec " + name;
      chatMessages.innerHTML = "";
      const saved = JSON.parse(localStorage.getItem("chat_" + id)) || [];
      saved.forEach(msg => {
        const div = document.createElement("div");
        div.textContent = msg;
        chatMessages.appendChild(div);
      });
      chatBox.style.display = "flex";
    }

    function sendMessage() {
      const input = document.getElementById("chatInput");
      const text = input.value.trim();
      if (!text) return;
      const div = document.createElement("div");
      div.textContent = text;
      chatMessages.appendChild(div);
      input.value = "";
      const id = currentChatId;
      let saved = JSON.parse(localStorage.getItem("chat_" + id)) || [];
      saved.push(text);
      localStorage.setItem("chat_" + id, JSON.stringify(saved));
    }

    function enableDrag(el) {
      el.addEventListener("dragstart", (e) => {
        e.dataTransfer.setData("text/plain", el.id);
      });
    }

    sidebar.addEventListener("dragover", (e) => e.preventDefault());
    sidebar.addEventListener("drop", (e) => {
      e.preventDefault();
      const id = e.dataTransfer.getData("text");
      const el = document.getElementById(id);
      if (el) sidebar.appendChild(el);
    });
  </script>
</body>
</html>
