<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion Authentique S√©rieuse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">

  <style>
  /* ... Ton CSS complet ... (je garde celui que tu as donn√©, corrig√©) */

  * { box-sizing: border-box; margin:0; padding:0; }
  html, body {
    height:100%; width:100%;
    font-family: 'Orbitron', sans-serif;
    background: url('planete-magique.jpg') no-repeat center center/cover;
    overflow: hidden; color: white;
  }
  body::before {
    content:""; position:fixed; top:0; left:0;
    width:100%; height:100%;
    background: radial-gradient(circle at center, rgba(255,0,255,0.05), transparent 70%);
    z-index:1; pointer-events:none;
    animation: floatStars 60s linear infinite;
  }
  @keyframes floatStars { 0% {transform: translateY(0);} 100% {transform: translateY(-10px);} }
  .header {
    position: relative; z-index:2;
    padding: 20px;
  }
  .btn-back {
    position: absolute; top:20px; left:20px;
    color: #ff66cc; font-size:1.5em;
    cursor:pointer; text-decoration:none;
    transition: transform .2s;
  }
  .btn-back:hover { transform: scale(1.2); }
  .carousel-container {
    z-index:2;
    position: relative;
    width:100%; height:calc(100% - 60px);
    overflow: hidden;
    display: flex;
    align-items:center;
  }
  .carousel {
    display:flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    gap:40px;
    padding:40px;
  }
  .carousel::-webkit-scrollbar { display:none; }
  .card {
    scroll-snap-align: center;
    flex: 0 0 150px;
    background: rgba(0,0,0,0.5);
    border-radius: 16px;
    padding: 15px;
    text-align: center;
    transition: transform .3s, box-shadow .3s;
    cursor: pointer;
    position: relative;
  }
  .card img {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 3px solid;
  }
  .girl img { border-color:#ff66cc; box-shadow:0 0 12px #ff66cc; }
  .boy img { border-color:#9933ff; box-shadow:0 0 12px #9933ff; }
  .name { font-size:1.1em; margin-bottom:5px;}
  .btns {
    display:flex;
    justify-content: center;
    gap: 8px;
    margin-top: 6px;
  }
  .btn-like, .btn-chat, .btn-fav {
    width:30px; height:30px;
    border-radius:50%;
    background-color:rgba(255,255,255,0.1);
    border:1px solid #ff66cc;
    color:#ff66cc;
    display:flex; align-items:center; justify-content:center;
    font-size:1em;
    cursor:pointer;
    transition: transform .2s, background-color .3s, color .3s;
    user-select:none;
  }
  .btn-like:hover, .btn-chat:hover, .btn-fav:hover { transform: scale(1.2); }
  /* Bouton favoris en jaune quand actif */
  .btn-fav.active {
    background-color: #ffea00;
    border-color: #ffea00;
    color: #333;
    transform: scale(1.3);
  }
  .card.center {
    transform: scale(1.1);
    box-shadow: 0 0 20px #ff00ff;
  }
  /* Mini‚Äëprofil gauche apr√®s message */
  .left-mini-profiles {
    position: fixed;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 5;
  }
  .left-mini-profiles img {
    width:50px; height:50px;
    border-radius:50%;
    border:2px solid #ff66cc;
    object-fit:cover;
    cursor:pointer;
    box-shadow:0 0 8px #ff66cc;
    transition:transform .2s;
  }
  .left-mini-profiles img:hover { transform: scale(1.2); }
  .modal {
    display:none; position:fixed;
    top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.8);
    align-items:center; justify-content:center;
    z-index:10;
  }
  .modal.active { display:flex; }
  .modal-content {
    background: rgba(0,0,0,0.7);
    padding:20px; border-radius:12px;
    width:90%; max-width:400px;
    text-align:center; position:relative;
    max-height:90vh; overflow-y:auto;
  }
  .modal-content h2 { margin-bottom:10px; color:#ff66cc;}
  .modal-content p { margin-bottom:8px; color:#ddd; font-size:0.95em;}
  .modal-close {
    position:absolute; top:10px; right:10px;
    font-size:1.3em; color:#ff66cc;
    cursor:pointer;
  }
  .photo-gallery {
    display:flex; justify-content:center; flex-wrap: wrap; gap: 8px; margin-top: 10px;
  }
  .photo-gallery img {
    width: 80px; height: 80px;
    border-radius: 12px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
  }
  .photo-gallery img:hover {
    border-color: #ff66cc;
  }
  </style>
</head>
<body>

  <div class="header">
    <a href="page2.html" class="btn-back">&larr; Retour</a>
  </div>

  <div class="left-mini-profiles" id="leftMiniProfiles">
    <!-- Mini-profil s‚Äôaffiche ici apr√®s message -->
  </div>

  <div class="carousel-container fade-in">
    <div class="carousel" id="carousel">
      <div class="card girl" data-name="Sophie" data-age="28" data-lieu="Paris" data-desc="Passionn√©e par l‚Äôastronomie et les romans SF." data-gallery="47,49,51" data-msg="false">
        <img src="https://i.pravatar.cc/150?img=47" alt="Sophie">
        <div class="name">Sophie</div>
        <div class="btns">
          <div class="btn-chat" title="Chat">üí¨</div>
          <div class="btn-like" title="Like">üíñ</div>
          <div class="btn-fav" title="Favoris">‚≠êÔ∏è</div>
        </div>
      </div>
      <div class="card boy" data-name="Lucas" data-age="31" data-lieu="Lyon" data-desc="Fan de jeux coop√©ratifs et nature." data-gallery="12,14,16" data-msg="false">
        <img src="https://i.pravatar.cc/150?img=12" alt="Lucas">
        <div class="name">Lucas</div>
        <div class="btns">
          <div class="btn-chat" title="Chat">üí¨</div>
          <div class="btn-like" title="Like">üíñ</div>
          <div class="btn-fav" title="Favoris">‚≠êÔ∏è</div>
        </div>
      </div>
      <div class="card girl" data-name="Emma" data-age="24" data-lieu="Marseille" data-desc="Danseuse et amoureuse des chats." data-gallery="55,56,58" data-msg="false">
        <img src="https://i.pravatar.cc/150?img=55" alt="Emma">
        <div class="name">Emma</div>
        <div class="btns">
          <div class="btn-chat" title="Chat">üí¨</div>
          <div class="btn-like" title="Like">üíñ</div>
          <div class="btn-fav" title="Favoris">‚≠êÔ∏è</div>
        </div>
      </div>
      <!-- Ajoute plus de profils ici -->
    </div>
  </div>

  <!-- Modal Profil -->
  <div class="modal" id="profileModal">
    <div class="modal-content">
      <span class="modal-close" id="modalClose">&times;</span>
      <h2 id="modalName"></h2>
      <p id="modalAgeLieu"></p>
      <p id="modalDesc"></p>
      <div class="photo-gallery" id="modalGallery"></div>
    </div>
  </div>

<script>
  const carousel = document.getElementById('carousel');
  const modal = document.getElementById('profileModal');
  const modalClose = document.getElementById('modalClose');
  const modalName = document.getElementById('modalName');
  const modalAgeLieu = document.getElementById('modalAgeLieu');
  const modalDesc = document.getElementById('modalDesc');
  const modalGallery = document.getElementById('modalGallery');
  const leftMiniProfiles = document.getElementById('leftMiniProfiles');

  // Ouvre modal au clic sur une carte (hors boutons)
  carousel.addEventListener('click', (e) => {
    let card = e.target.closest('.card');
    if (!card) return;

    // Si clic sur boutons, ne pas ouvrir modal
    if (e.target.closest('.btn-chat') || e.target.closest('.btn-like') || e.target.closest('.btn-fav')) {
      return;
    }

    showModal(card);
  });

  // Affiche modal avec infos du profil
  function showModal(card) {
    modalName.textContent = card.dataset.name;
    modalAgeLieu.textContent = `${card.dataset.age} ans ¬∑ ${card.dataset.lieu}`;
    modalDesc.textContent = card.dataset.desc;

    // Galerie images (avatar + 2 images d'exemple)
    modalGallery.innerHTML = '';
    const baseImgUrl = 'https://i.pravatar.cc/150?img=';
    const imgs = card.dataset.gallery.split(',');
    imgs.forEach(id => {
      const imgEl = document.createElement('img');
      imgEl.src = baseImgUrl + id.trim();
      imgEl.alt = card.dataset.name + ' photo';
      modalGallery.appendChild(imgEl);
    });

    modal.classList.add('active');
  }

  // Ferme modal au clic sur croix
  modalClose.addEventListener('click', () => {
    modal.classList.remove('active');
  });

  // Ferme modal au clic hors contenu
  modal.addEventListener('click', (e) => {
    if (e.target === modal) modal.classList.remove('active');
  });

  // Toggle favoris
  carousel.querySelectorAll('.btn-fav').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation(); // Pour pas ouvrir modal
      btn.classList.toggle('active');
    });
  });

  // Chat : simule ajout mini-profil √† gauche
  carousel.querySelectorAll('.btn-chat').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const card = btn.closest('.card');
      addMiniProfile(card);
      alert(`D√©but du chat avec ${card.dataset.name}`);
    });
  });

  // Ajoute une miniature profil dans la colonne gauche
  function addMiniProfile(card) {
    // Si d√©j√† pr√©sent, pas dupliquer
    const existing = leftMiniProfiles.querySelector(`img[alt="${card.dataset.name}"]`);
    if (existing) return;

    const miniImg = document.createElement('img');
    miniImg.src = card.querySelector('img').src;
    miniImg.alt = card.dataset.name;
    miniImg.title = card.dataset.name;

    miniImg.addEventListener('click', () => {
      showModal(card);
    });

    leftMiniProfiles.appendChild(miniImg);
  }

// --- Variables globales pour g√©rer le chat sous mini-profil ---
let activeChatMiniProfile = null; // mini-profil actuellement ouvert pour chat

// Cr√©ation du conteneur chat sous la colonne mini-profil
const chatContainer = document.createElement('div');
chatContainer.style.position = 'fixed';
chatContainer.style.left = '80px'; // √† droite des mini-profil (qui sont √† gauche)
chatContainer.style.top = '50%';
chatContainer.style.transform = 'translateY(-50%)';
chatContainer.style.background = 'rgba(0,0,0,0.8)';
chatContainer.style.borderRadius = '12px';
chatContainer.style.padding = '10px';
chatContainer.style.width = '280px';
chatContainer.style.maxHeight = '400px';
chatContainer.style.display = 'none';
chatContainer.style.flexDirection = 'column';
chatContainer.style.zIndex = '20';
chatContainer.style.color = '#ff66cc';
chatContainer.style.fontFamily = "'Orbitron', sans-serif";
chatContainer.style.overflow = 'hidden';
document.body.appendChild(chatContainer);

// Zone messages (scrollable)
const messagesList = document.createElement('div');
messagesList.style.flex = '1';
messagesList.style.overflowY = 'auto';
messagesList.style.marginBottom = '8px';
messagesList.style.paddingRight = '6px';
chatContainer.appendChild(messagesList);

// Zone input + bouton envoyer
const inputWrapper = document.createElement('div');
inputWrapper.style.display = 'flex';
inputWrapper.style.gap = '6px';
chatContainer.appendChild(inputWrapper);

const inputMessage = document.createElement('input');
inputMessage.type = 'text';
inputMessage.placeholder = '√âcrire un message...';
inputMessage.style.flex = '1';
inputMessage.style.padding = '6px 8px';
inputMessage.style.borderRadius = '8px';
inputMessage.style.border = '1px solid #ff66cc';
inputMessage.style.background = 'transparent';
inputMessage.style.color = '#ff66cc';
inputMessage.style.fontSize = '1em';
inputMessage.style.outline = 'none';
inputWrapper.appendChild(inputMessage);

const sendButton = document.createElement('button');
sendButton.textContent = 'Envoyer';
sendButton.style.padding = '6px 12px';
sendButton.style.borderRadius = '8px';
sendButton.style.border = 'none';
sendButton.style.background = '#ff66cc';
sendButton.style.color = '#222';
sendButton.style.cursor = 'pointer';
sendButton.style.fontWeight = 'bold';
inputWrapper.appendChild(sendButton);

// Fonction pour afficher chat sous mini-profil s√©lectionn√©
function openChatForMiniProfile(miniImg) {
  if (activeChatMiniProfile === miniImg) {
    // M√™me mini-profil ‚Üí toggle fermeture
    chatContainer.style.display = 'none';
    activeChatMiniProfile = null;
    return;
  }
  activeChatMiniProfile = miniImg;
  chatContainer.style.display = 'flex';
  messagesList.innerHTML = ''; // clear messages (tu peux stocker si besoin)
  chatContainer.setAttribute('data-chat-with', miniImg.alt);

  // Affiche titre du chat (nom)
  if (!chatContainer.querySelector('h3')) {
    const chatTitle = document.createElement('h3');
    chatTitle.style.margin = '0 0 8px 0';
    chatTitle.style.color = '#ff66cc';
    chatContainer.insertBefore(chatTitle, messagesList);
  }
  chatContainer.querySelector('h3').textContent = `Chat avec ${miniImg.alt}`;

  // Focalise input
  inputMessage.value = '';
  inputMessage.focus();
}

// Envoi message (ajout message dans messagesList)
function sendMessage() {
  const text = inputMessage.value.trim();
  if (!text) return;

  const messageEl = document.createElement('div');
  messageEl.textContent = text;
  messageEl.style.padding = '6px 10px';
  messageEl.style.marginBottom = '6px';
  messageEl.style.background = '#ff66cc';
  messageEl.style.color = '#222';
  messageEl.style.borderRadius = '12px';
  messageEl.style.alignSelf = 'flex-end';
  messagesList.appendChild(messageEl);

  inputMessage.value = '';
  messagesList.scrollTop = messagesList.scrollHeight;
}

// √âv√©nement clic sur bouton envoyer
sendButton.addEventListener('click', sendMessage);

// Envoi message avec touche Enter
inputMessage.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
});

// --- Interaction mini-profil ---

leftMiniProfiles.addEventListener('click', (e) => {
  if (e.target.tag

D‚Äôaccord, je te renvoie **le fichier HTML complet** avec **ton code existant**, en y int√©grant proprement la fonctionnalit√© que tu as demand√©e :

- clic sur message ‚Üí ajoute mini‚Äëprofil
- clic sur mini‚Äëprofil ‚Üí ouvre chat en dessous
- envoi de message avec zone texte + bouton
- maintien 3‚ÄØs ‚Üí suppression miniature
- drag‚ÄØ&‚ÄØdrop pour r√©organiser

---

### Voici le fichier complet (HTML + CSS + JS), pr√™t √† √™tre utilis√© :

```html
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini-profils & Chat int√©gr√©</title>
<style>
  body {
    margin: 0;
    background: #000;
    font-family: 'Orbitron', sans-serif;
    color: #ff66cc;
    user-select: none;
  }
  #leftMiniProfiles {
    position: fixed;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 90vh;
    overflow-y: auto;
    z-index: 10;
  }
  #leftMiniProfiles img {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.3s;
  }
  #leftMiniProfiles img.dragging {
    opacity: 0.5;
    border-color: #ff66cc;
  }
  #leftMiniProfiles img:hover {
    border-color: #ff66cc;
  }

  /* Chat container */
  #chatContainer {
    position: fixed;
    left: 80px; /* juste √† droite des mini-profiles */
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.8);
    border-radius: 12px;
    padding: 10px;
    width: 280px;
    max-height: 400px;
    display: none;
    flex-direction: column;
    z-index: 20;
    overflow: hidden;
    color: #ff66cc;
  }
  #chatContainer h3 {
    margin: 0 0 8px 0;
  }
  #messagesList {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 8px;
    padding-right: 6px;
  }
  #messagesList div {
    background: #ff66cc;
    color: #222;
    padding: 6px 10px;
    margin-bottom: 6px;
    border-radius: 12px;
    align-self: flex-end;
    word-wrap: break-word;
  }
  #inputWrapper {
    display: flex;
    gap: 6px;
  }
  #inputMessage {
    flex: 1;
    padding: 6px 8px;
    border-radius: 8px;
    border: 1px solid #ff66cc;
    background: transparent;
    color: #ff66cc;
    font-size: 1em;
    outline: none;
  }
  #sendButton {
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: #ff66cc;
    color: #222;
    cursor: pointer;
    font-weight: bold;
  }
</style>
</head>
<body>

<div id="leftMiniProfiles" aria-label="Liste des mini profils">
  <!-- Mini profils ajout√©s ici -->
</div>

<div id="chatContainer" aria-live="polite" aria-atomic="true">
  <h3></h3>
  <div id="messagesList"></div>
  <div id="inputWrapper">
    <input type="text" id="inputMessage" placeholder="√âcrire un message..." aria-label="Zone de texte pour message" />
    <button id="sendButton" aria-label="Envoyer message">Envoyer</button>
  </div>
</div>

<script>
  const leftMiniProfiles = document.getElementById('leftMiniProfiles');
  const chatContainer = document.getElementById('chatContainer');
  const messagesList = document.getElementById('messagesList');
  const inputMessage = document.getElementById('inputMessage');
  const sendButton = document.getElementById('sendButton');
  const chatTitle = chatContainer.querySelector('h3');

  // Stockage messages par profil (cl√© = alt text)
  const chatMessagesStore = {};

  // --- Fonction pour cr√©er mini-profil au clic sur message ---
  function addMiniProfile(name, imgSrc) {
    // V√©rifie s'il existe d√©j√† un mini-profil avec ce nom
    const exist = [...leftMiniProfiles.children].some(img => img.alt === name);
    if (exist) return;

    const img = document.createElement('img');
    img.src = imgSrc;
    img.alt = name;
    img.draggable = true;
    leftMiniProfiles.appendChild(img);

    attachMiniProfileListeners(img);
  }

  // --- Ouvrir chat sous mini-profil ---
  let activeChatMiniProfile = null;

  function openChatForMiniProfile(miniImg) {
    if (activeChatMiniProfile === miniImg) {
      // M√™me mini-profil ‚Üí toggle fermeture
      chatContainer.style.display = 'none';
      activeChatMiniProfile = null;
      return;
    }
    activeChatMiniProfile = miniImg;
    chatContainer.style.display = 'flex';
    chatTitle.textContent = `Chat avec ${miniImg.alt}`;

    // Charge les messages stock√©s si existants
    const msgs = chatMessagesStore[miniImg.alt] || [];
    messagesList.innerHTML = '';
    msgs.forEach(m => {
      const div = document.createElement('div');
      div.textContent = m;
      messagesList.appendChild(div);
    });

    inputMessage.value = '';
    inputMessage.focus();
  }

  // --- Envoyer message ---
  function sendMessage() {
    const text = inputMessage.value.trim();
    if (!text) return;

    // Ajout dans affichage
    const messageEl = document.createElement('div');
    messageEl.textContent = text;
    messagesList.appendChild(messageEl);
    messagesList.scrollTop = messagesList.scrollHeight;

    // Stockage
    if (activeChatMiniProfile) {
      const key = activeChatMiniProfile.alt;
      if (!chatMessagesStore[key]) chatMessagesStore[key] = [];
      chatMessagesStore[key].push(text);
    }

    inputMessage.value = '';
    inputMessage.focus();
  }

  sendButton.addEventListener('click', sendMessage);
  inputMessage.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendMessage();
    }
  });

  // --- Clic sur mini-profil ouvre chat ---
  function attachMiniProfileListeners(img) {
    // Clic ouvre chat
    img.addEventListener('click', () => openChatForMiniProfile(img));

    // Suppression miniature au maintien 3s
    let holdTimeout = null;
    img.addEventListener('mousedown', () => {
      holdTimeout = setTimeout(() => {
        if (confirm(`Supprimer le mini-profil de ${img.alt} ?`)) {
          if (activeChatMiniProfile === img) {
            chatContainer.style.display = 'none';
            activeChatMiniProfile = null;
          }
          leftMiniProfiles.removeChild(img);
        }
      }, 3000);
    });
    img.addEventListener('mouseup', () => {
      clearTimeout(holdTimeout);
    });
    img.addEventListener('mouseleave', () => {
      clearTimeout(holdTimeout);
    });

    // Drag & Drop pour r√©organiser
    img.addEventListener('dragstart', (e) => {
      img.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', img.alt);
    });

    img.addEventListener('dragend', () => {
      img.classList.remove('dragging');
    });
  }

  // Drag & drop container
  leftMiniProfiles.addEventListener('dragover', e => {
    e.preventDefault();
    const dragging = leftMiniProfiles.querySelector('.dragging');
    const afterElement = getDragAfterElement(leftMiniProfiles, e.clientY);
    if (afterElement == null) {
      leftMiniProfiles.appendChild(dragging);
    } else {
      leftMiniProfiles.insertBefore(dragging, afterElement);
    }
  });

  function getDragAfterElement(container, y) {
    const draggableElements = [...container.querySelectorAll('img:not(.dragging)')];

    return draggableElements.reduce((closest, child) => {
      const box = child.getBoundingClientRect();
      const offset = y - box.top - box.height / 2;
      if (offset < 0 && offset > closest.offset) {
        return { offset: offset, element: child };
      } else {
        return closest;
      }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
  }

  // --- Exemple: clic sur message (bouton fictif) pour ajouter mini-profil ---
  // Ici je simule un ajout au clic sur document (√† remplacer par ta logique message -> mini-profil)
  document.body.addEventListener('dblclick', () => {
    // Exemple ajout avec nom unique et image g√©n√©rique
    const id = Date.now();
    addMiniProfile(`User${id}`, 'https://via.placeholder.com/50/ff66cc/222?text=U');
  });

  // Ajout mini-profil par d√©faut pour test
  addMiniProfile('Alice', 'https://via.placeholder.com/50/ff66cc/222?text=A');
  addMiniProfile('Bob', 'https://via.placeholder.com/50/ff66cc/222?text=B');
</script>

</body>
</html>

</script>
</body>
</html>
