<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carte + Modal + Favoris</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #leftMiniProfiles {
      width: 100px;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 0;
      overflow-y: auto;
    }
    #leftMiniProfiles img {
      width: 60px;
      height: 60px;
      margin: 5px 0;
      border-radius: 12px;
      cursor: pointer;
      position: relative; /* Pour drag */
      user-select: none;
    }
    #cardsContainer {
      flex: 1;
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding: 20px;
      background: #f5f5f5;
      align-items: center;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      width: 200px;
      margin-right: 20px;
      padding: 15px;
      cursor: pointer;
      user-select: none;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .card img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin-bottom: 10px;
    }
    .btns {
      margin-top: auto;
      display: flex;
      gap: 10px;
    }
    .btn-fav {
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      transition: color 0.3s;
      user-select: none;
    }
    .btn-fav.active {
      color: gold;
    }

    /* Modal */
    #modalDetails {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    #modalDetails.active {
      display: flex;
    }
    #modalContent {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      padding: 20px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    #modalClose {
      position: absolute;
      top: 10px; right: 15px;
      font-size: 24px;
      cursor: pointer;
      border: none;
      background: none;
    }
    #modalName {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #photoGallery {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
  </style>
</head>
<body>
  <div id="leftMiniProfiles" title="Favoris"></div>

  <div id="cardsContainer">
    <!-- Exemple de cartes -->
    <div class="card" data-name="Alice" data-age="28" data-lieu="Paris" data-desc="Passionnée de voyage et photo." data-gallery="10,15,20">
      <img src="https://i.pravatar.cc/150?img=10" alt="Alice" />
      <div><strong>Alice</strong>, 28</div>
      <div>Paris</div>
      <div class="btns">
        <button class="btn-fav" title="Ajouter aux favoris">⭐️</button>
      </div>
    </div>

    <div class="card" data-name="Bob" data-age="34" data-lieu="Lyon" data-desc="Fan de musique et de sport." data-gallery="12,18,22">
      <img src="https://i.pravatar.cc/150?img=12" alt="Bob" />
      <div><strong>Bob</strong>, 34</div>
      <div>Lyon</div>
      <div class="btns">
        <button class="btn-fav" title="Ajouter aux favoris">⭐️</button>
      </div>
    </div>

    <div class="card" data-name="Chloé" data-age="25" data-lieu="Marseille" data-desc="Amoureuse de la nature et des animaux." data-gallery="5,8,14">
      <img src="https://i.pravatar.cc/150?img=5" alt="Chloé" />
      <div><strong>Chloé</strong>, 25</div>
      <div>Marseille</div>
      <div class="btns">
        <button class="btn-fav" title="Ajouter aux favoris">⭐️</button>
      </div>
    </div>
  </div>

  <!-- Modal détails -->
  <div id="modalDetails" role="dialog" aria-modal="true" aria-labelledby="modalName">
    <div id="modalContent">
      <button id="modalClose" aria-label="Fermer modal">&times;</button>
      <div id="modalName"></div>
      <div><strong>Âge :</strong> <span id="modalAge"></span></div>
      <div><strong>Lieu :</strong> <span id="modalLieu"></span></div>
      <p id="modalDesc"></p>
      <div id="photoGallery"></div>
    </div>
  </div>

  <script>
    const cards = document.querySelectorAll('.card');
    const modal = document.getElementById('modalDetails');
    const modalClose = document.getElementById('modalClose');
    const modalName = document.getElementById('modalName');
    const modalAge = document.getElementById('modalAge');
    const modalLieu = document.getElementById('modalLieu');
    const modalDesc = document.getElementById('modalDesc');
    const photoGallery = document.getElementById('photoGallery');
    const leftMiniProfiles = document.getElementById('leftMiniProfiles');

    // Ouvrir modal détails au clic sur une carte (sauf sur boutons)
    cards.forEach(card => {
      card.addEventListener('click', (e) => {
        if (e.target.closest('.btns')) return; // ignorer si clic sur bouton
        modalName.textContent = card.dataset.name;
        modalAge.textContent = card.dataset.age;
        modalLieu.textContent = card.dataset.lieu;
        modalDesc.textContent = card.dataset.desc;

        // Générer miniatures photo galerie
        photoGallery.innerHTML = '';
        const imgs = card.dataset.gallery ? card.dataset.gallery.split(',') : [];
        imgs.forEach(id => {
          const img = document.createElement('img');
          img.src = `https://i.pravatar.cc/150?img=${id.trim()}`;
          img.style.width = '70px';
          img.style.height = '70px';
          img.style.margin = '5px';
          img.style.borderRadius = '12px';
          photoGallery.appendChild(img);
        });

        modal.classList.add('active');
      });

      // Gérer le clic sur favoris (⭐️)
      const favBtn = card.querySelector('.btn-fav');
      favBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        favBtn.classList.toggle('active');
        if (favBtn.classList.contains('active')) {
          addMiniProfile(card);
        } else {
          removeMiniProfile(card.dataset.name);
        }
      });
    });

    modalClose.addEventListener('click', () => {
      modal.classList.remove('active');
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        modal.classList.remove('active');
      }
    });

    // Ajouter miniature dans la barre gauche
    function addMiniProfile(card) {
      // Vérifier si déjà ajouté
      if ([...leftMiniProfiles.children].some(img => img.alt === card.dataset.name)) return;

      const img = document.createElement('img');
      img.src = card.querySelector('img').src;
      img.alt = card.dataset.name;
      img.title = card.dataset.name;
      leftMiniProfiles.appendChild(img);

      // Clic sur miniature scroll carousel vers la carte
      img.addEventListener('click', () => {
        card.scrollIntoView({behavior: 'smooth', inline: 'center', block: 'nearest'});
      });

      // Déplacement miniature (drag)
      let isDragging = false, startX, startY, origX, origY;
      img.style.position = 'relative';

      img.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        origX = img.offsetLeft;
        origY = img.offsetTop;
        img.style.cursor = 'grabbing';
        e.preventDefault();
      });
      window.addEventListener('mouseup', () => {
        if (isDragging) {
          isDragging = false;
          img.style.cursor = 'pointer';
        }
      });
      window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        img.style.left = (origX + dx) + 'px';
        img.style.top = (origY + dy) + 'px';
      });
    }

    // Supprimer miniature
    function removeMiniProfile(name) {
      [...leftMiniProfiles.children].forEach(img => {
        if (img.alt === name) leftMiniProfiles.removeChild(img);
      });
    }
  </script>
</body>
</html>
