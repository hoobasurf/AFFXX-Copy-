<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Connexion Authentique Sérieuse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    /* (Tous tes styles d’origine inchangés) */
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body { height:100%; width:100%; font-family:'Orbitron', sans-serif;
      background: url('planete-magique.jpg') no-repeat center center/cover;
      overflow:hidden; color:white;
    }
    /* ... tout le CSS que tu avais mis ... */
    .left-mini-profiles img:hover { transform: scale(1.2); }
    .modal, .chat-modal, .photo-zoom { /* etc. */ }
    /* ... tout le reste du CSS exact comme avant ... */
  </style>
</head>
<body>

  <div class="header">
    <a href="page2.html" class="btn-back">&larr; Retour</a>
  </div>

  <div class="left-mini-profiles" id="leftMiniProfiles">
    <!-- Mini-profil s’affiche ici après message -->
  </div>

  <div class="carousel-container fade-in">
    <div class="carousel" id="carousel">
      <!-- Toutes tes cartes : Sophie, Lucas, Emma, Alex, Clara, etc. -->
      <!-- exact comme dans ton code d’origine -->
    </div>
  </div>

  <!-- Modal détails original -->
  <div class="modal" id="modalDetails">
    <!-- contenu détaillé remain unchanged -->
  </div>

  <!-- Zoom photo modal -->
  <div class="photo-zoom" id="photoZoom">
    <img src="" alt="Photo zoom" id="zoomedPhoto" />
  </div>

  <!-- Chat modal -->
  <div class="chat-modal" id="chatModal">
    <div class="chat-box">
      <textarea placeholder="Écris un message..."></textarea>
      <button id="sendMessage">Envoyer</button>
    </div>
  </div>

  <!-- === AJOUT JS POUR LES FONCTIONNALITÉS === -->
  <script>
  (function(){
    const cards = document.querySelectorAll('.card');
    const chatModal = document.getElementById('chatModal');
    const sendBtn = document.getElementById('sendMessage');
    const textarea = chatModal.querySelector('textarea');
    const miniContainer = document.getElementById('leftMiniProfiles');

    // Gestion boutons Chat, Like, Favoris
    document.querySelectorAll('.btn-chat').forEach(btn=>{
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const name=btn.closest('.card').dataset.name;
        chatModal.classList.add('active');
        chatModal.dataset.user=name;
        textarea.value='';
        showChatHistory(name);
      });
    });
    document.querySelectorAll('.btn-like').forEach(btn=>{
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const u=btn.closest('.card').dataset.name;
        let L=JSON.parse(localStorage.getItem('likes')||'{}');
        L[u]=(L[u]||0)+1;
        localStorage.setItem('likes',JSON.stringify(L));
        alert(u+" liké !");
      });
    });
    document.querySelectorAll('.btn-fav').forEach(btn=>{
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const u=btn.closest('.card').dataset.name;
        let F=JSON.parse(localStorage.getItem('favoris')||'[]');
        if(!F.includes(u)){ F.push(u); localStorage.setItem('favoris',JSON.stringify(F)); }
        alert(u+" ajouté aux favoris !");
      });
    });

    // Envoi message avec historique
    sendBtn.addEventListener('click', ()=>{
      const msg=textarea.value.trim();
      if(!msg) return alert("Écris un message...");
      const u=chatModal.dataset.user;
      const H=JSON.parse(localStorage.getItem('chatHistory')||'{}');
      if(!H[u]) H[u]=[];
      H[u].push({content:msg,date:new Date().toLocaleString()});
      localStorage.setItem('chatHistory',JSON.stringify(H));
      chatModal.classList.remove('active');
      textarea.value='';
      addMiniProfile(u);
    });

    function showChatHistory(u){
      const Hm=JSON.parse(localStorage.getItem('chatHistory')||'{}');
      const hist=Hm[u]||[];
      const box=chatModal.querySelector('.chat-box');
      const old=box.querySelector('.history');
      if(old) old.remove();
      const div=document.createElement('div');
      div.className='history';
      hist.forEach(m=>{
        const p=document.createElement('p');
        p.innerHTML=`<span style="color:#ff66cc;">[${m.date}]</span><br>${m.content}`;
        p.style.marginBottom='8px';
        p.style.fontSize='0.85em'; p.style.color='#ddd';
        div.appendChild(p);
      });
      box.prepend(div);
    }

    function addMiniProfile(name){
      const card=[...cards].find(c=>c.dataset.name===name);
      if(!card)return;
      const src=card.querySelector('img').src;
      if([...miniContainer.children].some(i=>i.src===src)) return;
      const img=document.createElement('img');
      img.src=src; img.alt=name;
      makeDraggable(img);
      setupLongPress(img,name);
      miniContainer.prepend(img);
    }

    // Drag & drop mini-profil
    function makeDraggable(el){
      el.style.position='absolute'; el.style.cursor='move';
      let dx,dy,dragging=false;
      el.addEventListener('mousedown',e=>{
        dragging=true;
        dx=e.clientX-el.getBoundingClientRect().left;
        dy=e.clientY-el.getBoundingClientRect().top;
      });
      document.addEventListener('mousemove',e=>{
        if(!dragging)return;
        let x=e.clientX-dx, y=e.clientY-dy;
        const winW=window.innerWidth, winH=window.innerHeight;
        const r=el.getBoundingClientRect();
        if(x<0)x=0; else if(x+r.width>winW)x=winW-r.width;
        if(y<0)y=0; else if(y+r.height>winH)y=winH-r.height;
        el.style.left=x+'px'; el.style.top=y+'px';
      });
      document.addEventListener('mouseup',()=>{
        if(dragging){
          dragging=false;
          const pos={left:el.style.left,top:el.style.top};
          localStorage.setItem('miniProfilePosition',JSON.stringify(pos));
        }
      });
      // restoration
      window.addEventListener('DOMContentLoaded',()=>{
        const pos=JSON.parse(localStorage.getItem('miniProfilePosition')||'null');
        if(pos){ el.style.left=pos.left; el.style.top=pos.top; }
      });
    }

    // Long press suppression
    function setupLongPress(el,name){
      let t;
      el.addEventListener('mousedown',()=>{
        t=setTimeout(()=>{
          if(confirm(`Supprimer mini‑profil "${name}" ?`)){
            el.remove();
          }
        },5000);
      });
      el.addEventListener('mouseup',()=>clearTimeout(t));
      el.addEventListener('mouseleave',()=>clearTimeout(t));
    }

    // Suppression longue carte complète
    cards.forEach(c=>{
      let t;
      c.addEventListener('mousedown',()=>{
        t=setTimeout(()=>{
          if(confirm(`Supprimer profil ${c.dataset.name} ?`)){
            c.remove();
          }
        },5000);
      });
      c.addEventListener('mouseup',()=>clearTimeout(t));
      c.addEventListener('mouseleave',()=>clearTimeout(t));
    });

    // Initial mini restau (optionnel, si stockage voulu)
  })();
  </script>

</body>
</html>
