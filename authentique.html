<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini Profils</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #111; color: #fff; }
    .container { padding: 20px; }
    .mini-profiles { position: fixed; top: 20px; left: 20px; background: #222; padding: 10px; border-radius: 8px; cursor: move; z-index: 1000; }
    .card { background: #333; border-radius: 10px; padding: 15px; margin-bottom: 10px; position: relative; }
    .card .name { font-weight: bold; font-size: 18px; }
    .btns { margin-top: 10px; display: flex; gap: 10px; }
    .btns div { cursor: pointer; font-size: 20px; }
    .modal, .chat-modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 2000; }
    .modal-content, .chat-box { background: #222; padding: 20px; border-radius: 10px; max-width: 90vw; color: #fff; }
    .chat-box textarea { width: 100%; height: 80px; background: #111; color: #fff; }
    .chat-box button { margin-top: 10px; background: #ff66cc; border: none; padding: 10px; color: #fff; cursor: pointer; }
  </style>
</head>
<body>

<div class="container">
  <div class="mini-profiles" id="miniProfiles">
    <div class="card" data-name="Lucas">
      <div class="name">Lucas</div>
      <div class="btns">
        <div class="btn-chat" title="Chat">üí¨</div>
        <div class="btn-like" title="Like">üíñ</div>
        <div class="btn-fav" title="Favoris">‚≠êÔ∏è</div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Chat -->
<div class="chat-modal" id="chatModal">
  <div class="chat-box">
    <textarea id="chatMessage" placeholder="Tape ton message..."></textarea>
    <button id="sendMessage">Envoyer</button>
  </div>
</div>

<script>
  // Boutons
  document.querySelectorAll('.btn-chat').forEach(btn => {
    btn.addEventListener('click', e => {
      const name = btn.closest('.card').dataset.name;
      document.getElementById('chatModal').style.display = 'flex';
      document.getElementById('chatModal').dataset.user = name;
      showChatHistory(name);
    });
  });

  document.querySelectorAll('.btn-like').forEach(btn => {
    btn.addEventListener('click', () => {
      const name = btn.closest('.card').dataset.name;
      let likes = JSON.parse(localStorage.getItem('likes') || '[]');
      if (!likes.includes(name)) {
        likes.push(name);
        localStorage.setItem('likes', JSON.stringify(likes));
      }
      alert(name + " lik√© !");
    });
  });

  document.querySelectorAll('.btn-fav').forEach(btn => {
    btn.addEventListener('click', () => {
      const name = btn.closest('.card').dataset.name;
      let favs = JSON.parse(localStorage.getItem('favoris') || '[]');
      if (!favs.includes(name)) {
        favs.push(name);
        localStorage.setItem('favoris', JSON.stringify(favs));
      }
      alert(name + " ajout√© aux favoris !");
    });
  });

  // Chat : envoyer message
  document.getElementById('sendMessage').addEventListener('click', () => {
    const msg = document.getElementById('chatMessage').value.trim();
    if (!msg) return alert("√âcris un message");
    const name = document.getElementById('chatModal').dataset.user;
    const history = JSON.parse(localStorage.getItem('chatHistory') || '{}');
    if (!history[name]) history[name] = [];
    history[name].push({ content: msg, date: new Date().toLocaleString() });
    localStorage.setItem('chatHistory', JSON.stringify(history));
    document.getElementById('chatModal').style.display = 'none';
    document.getElementById('chatMessage').value = '';
  });

  function showChatHistory(name) {
    const box = document.querySelector('.chat-box');
    const old = box.querySelector('.history');
    if (old) old.remove();
    const hist = document.createElement('div');
    hist.className = 'history';
    const data = JSON.parse(localStorage.getItem('chatHistory') || '{}')[name] || [];
    data.forEach(m => {
      const p = document.createElement('p');
      p.innerHTML = `<span style="color:#ff66cc;">[${m.date}]</span><br>${m.content}`;
      p.style.marginBottom = '10px';
      p.style.fontSize = '0.85em';
      p.style.color = '#eee';
      hist.appendChild(p);
    });
    box.prepend(hist);
  }

  // D√©placement mini-profil
  const mini = document.getElementById('miniProfiles');
  let isDragging = false, offsetX = 0, offsetY = 0;

  mini.addEventListener('mousedown', e => {
    isDragging = true;
    offsetX = e.offsetX;
    offsetY = e.offsetY;
    mini.style.cursor = 'grabbing';
  });

  document.addEventListener('mousemove', e => {
    if (isDragging) {
      mini.style.position = 'fixed';
      mini.style.left = (e.clientX - offsetX) + 'px';
      mini.style.top = (e.clientY - offsetY) + 'px';
      localStorage.setItem('miniProfilePosition', JSON.stringify({ left: mini.style.left, top: mini.style.top }));
    }
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    mini.style.cursor = 'move';
  });

  // Restaurer position
  window.addEventListener('DOMContentLoaded', () => {
    const pos = JSON.parse(localStorage.getItem('miniProfilePosition'));
    if (pos) {
      mini.style.position = 'fixed';
      mini.style.left = pos.left;
      mini.style.top = pos.top;
    }
  });

  // Suppression pression longue
  document.querySelectorAll('.card').forEach(card => {
    let timer;
    card.addEventListener('mousedown', () => {
      timer = setTimeout(() => {
        if (confirm(`Supprimer ${card.dataset.name} ?`)) {
          card.remove();
        }
      }, 5000);
    });
    card.addEventListener('mouseup', () => clearTimeout(timer));
    card.addEventListener('mouseleave', () => clearTimeout(timer));
  });
</script>

</body>
</html>
