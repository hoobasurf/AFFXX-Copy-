<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Profils avec Favoris, Chat & Mini Profils Draggables</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f0f0;
  }
  #carousel {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 20px;
  }
  .card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
    width: 200px;
    margin: 10px;
    padding: 15px;
    text-align: center;
    position: relative;
  }
  .card img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
  }
  .card h3 {
    margin: 10px 0 15px;
  }

  /* Bouton Favori */
  .btn-fav {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 24px;
    cursor: pointer;
    color: #ccc;
    user-select: none;
    transition: color 0.3s ease;
  }
  .btn-fav.active {
    color: gold;
  }

  /* Bouton Chat */
  .btn-chat {
    background: #4a90e2;
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
  }
  .btn-chat:hover {
    background: #357abd;
  }

  /* Sidebar mini-profils */
  #leftMiniProfiles {
    position: fixed;
    top: 100px;
    left: 10px;
    width: 160px;
    max-height: 90vh;
    overflow: visible;
    z-index: 9999;
  }

  .mini-profile {
    display: flex;
    align-items: center;
    background: white;
    border-radius: 5px;
    margin-bottom: 10px;
    padding: 5px;
    box-shadow: 0 0 5px #ccc;
    user-select: none;
    width: 150px;
    position: absolute; /* pour drag & drop */
    cursor: grab;
  }

  .mini-profile img {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin-right: 8px;
    flex-shrink: 0;
  }

  /* Chat modal */
  #chatModal {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    width: 320px;
    max-width: 90vw;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    border-radius: 10px;
    z-index: 10000;
    flex-direction: column;
    padding: 20px;
  }

  #chatModal h3 {
    margin: 0 0 10px;
  }
  #chatModal textarea {
    width: 100%;
    height: 120px;
    margin-bottom: 10px;
    resize: vertical;
    font-size: 14px;
    padding: 8px;
  }
  #chatModal button {
    background: #4a90e2;
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 8px;
  }
  #chatModal button:hover {
    background: #357abd;
  }

  #closeChatModal {
    background: #d9534f;
  }
  #closeChatModal:hover {
    background: #b52b27;
  }

</style>
</head>
<body>

<!-- Sidebar mini profils -->
<div id="leftMiniProfiles"></div>

<!-- Carousel profils -->
<div id="carousel">
  <div class="card" data-name="Alice">
    <div class="btn-fav" title="Ajouter aux favoris">â˜†</div>
    <img src="https://i.pravatar.cc/100?u=alice" alt="Alice" />
    <h3>Alice</h3>
    <button class="btn-chat">ðŸ’¬ Chat</button>
  </div>
  <div class="card" data-name="Bob">
    <div class="btn-fav" title="Ajouter aux favoris">â˜†</div>
    <img src="https://i.pravatar.cc/100?u=bob" alt="Bob" />
    <h3>Bob</h3>
    <button class="btn-chat">ðŸ’¬ Chat</button>
  </div>
  <div class="card" data-name="Caroline">
    <div class="btn-fav" title="Ajouter aux favoris">â˜†</div>
    <img src="https://i.pravatar.cc/100?u=caroline" alt="Caroline" />
    <h3>Caroline</h3>
    <button class="btn-chat">ðŸ’¬ Chat</button>
  </div>
</div>

<!-- Chat Modal -->
<div id="chatModal">
  <h3>Chat avec <span id="chatUserName"></span></h3>
  <textarea id="chatMessage" placeholder="Ã‰cris ton message ici..."></textarea>
  <div>
    <button id="sendMessageBtn">Envoyer</button>
    <button id="closeChatModal">Fermer</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const carousel = document.getElementById('carousel');
  const cards = carousel.querySelectorAll('.card');
  const leftMiniProfiles = document.getElementById('leftMiniProfiles');

  // --- Bouton Favori â­ toggle ---
  cards.forEach(card => {
    const btnFav = card.querySelector('.btn-fav');
    btnFav.addEventListener('click', () => {
      btnFav.classList.toggle('active');
      // Changer lâ€™Ã©toile visuellement
      btnFav.textContent = btnFav.classList.contains('active') ? 'â˜…' : 'â˜†';
    });
  });

  // --- Sidebar mini-profils et chat ---
  const chatModal = document.getElementById('chatModal');
  const chatUserNameSpan = document.getElementById('chatUserName');
  const chatMessageTextarea = document.getElementById('chatMessage');
  const sendMessageBtn = document.getElementById('sendMessageBtn');
  const closeChatModalBtn = document.getElementById('closeChatModal');

  let currentChatProfile = null; // profil en cours de chat

  // Ouvre le chat modal pour un profil
  function openChat(profileCard) {
    currentChatProfile = profileCard.getAttribute('data-name');
    chatUserNameSpan.textContent = currentChatProfile;
    chatMessageTextarea.value = '';

    // Affiche lâ€™historique sâ€™il existe
    const history = localStorage.getItem('chat_' + currentChatProfile);
    if (history) {
      chatMessageTextarea.value = history;
    }

    chatModal.style.display = 'flex';
  }

  // Fermer modal chat
  closeChatModalBtn.addEventListener('click', () => {
    chatModal.style.display = 'none';
    currentChatProfile = null;
  });

  // Envoyer message dans chat (stockage local)
  sendMessageBtn.addEventListener('click', () => {
    if (!currentChatProfile) return;

    const msg = chatMessageTextarea.value.trim();
    if (msg.length === 0) return alert("Tapez un message.");

    // Sauvegarde dans localStorage
    localStorage.setItem('chat_' + currentChatProfile, msg);

    // Ajoute mini-profil dans sidebar s'il n'existe pas
    if (!leftMiniProfiles.querySelector(`[data-name='${CSS.escape(currentChatProfile)}']`)) {
      const origCard = Array.from(cards).find(c => c.getAttribute('data-name') === currentChatProfile);
      if (origCard) {
        const mini = createMiniProfile(origCard);
        // Position initiale dans la sidebar
        mini.style.left = '0px';
        mini.style.top = (leftMiniProfiles.childElementCount * 50) + 'px';
        leftMiniProfiles.appendChild(mini);
        makeDraggable(mini);
      }
    }

    alert("Message sauvegardÃ© pour " + currentChatProfile);
  });

  // CrÃ©e un mini-profil pour la sidebar Ã  partir dâ€™une carte profil
  function createMiniProfile(card) {
    const mini = document.createElement('div');
    mini.classList.add('mini-profile');
    mini.setAttribute('data-name', card.getAttribute('data-name'));

    const imgSrc = card.querySelector('img').src;
    const name = card.getAttribute('data-name');

    mini.innerHTML = `<img src="${imgSrc}" alt="${name}"><span>${name}</span>`;

    return mini;
  }

  // Rend un Ã©lÃ©ment draggable (drag & drop libre)
  function makeDraggable(element) {
    element.style.position = 'absolute';
    element.style.cursor = 'grab';

    let offsetX = 0, offsetY = 0, isDragging = false;

    element.addEventListener('mousedown', e => {
      isDragging = true;
      offsetX = e.clientX - element.getBoundingClientRect().left;
      offsetY = e.clientY - element.getBoundingClientRect().top;
      element.style.cursor = 'grabbing';
      e.preventDefault();
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      element.style.left = (e.clientX - offsetX) + 'px';
      element.style.top = (e.clientY - offsetY) + 'px';
    });

    document.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        element.style.cursor = 'grab';
      }
    });
  }

  // --- Boutons chat ouvrant la modal ---
  cards.forEach(card => {
    const btnChat = card.querySelector('.btn-chat');
    btnChat.addEventListener('click', () => {
      openChat(card);
    });
  });

});
</script>

</body>
</html>
